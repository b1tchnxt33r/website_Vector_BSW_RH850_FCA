---
layout: default
title: TechnicalReference_CanTp
nav_order: 25
parent: Doc
---
{% raw %}
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
     "http://www.w3.org/TR/html4/transitional.dtd">
<html>
<head>

  <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
  <title></title>
  <meta name="generator" content="LibreOffice 24.2.7.2 (Linux)"/>
  <meta name="created" content="00:00:00"/>
  <meta name="changed" content="00:00:00"/>
</head>
<body>
<h1></h1>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><b>MICROSAR CAN Transport Layer </b></p>
<p>Technical Reference </p>
<p> </p>
<p>  </p>
<p>Version 3.01.00 </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Authors </p>
<p>Thomas Dedler, Anthony Thomas </p>
<p>Status </p>
<p>Released </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>2 </p>
<p>based on template version 5.7.1 </p>
<p><b>Document Information </b></p>
<p><b>History </b></p>
<p><b>Author </b></p>
<p><b>Date </b></p>
<p><b>Version </b></p>
<p><b>Remarks </b></p>
<p>Thomas Dedler </p>
<p>2012-07-11 </p>
<p>1.00.00 </p>
<p>Initial version </p>
<p>Thomas Dedler </p>
<p>2012-11-26 </p>
<p>1.01.00 </p>
<p>Synchronous transmission feature removed  </p>
<p>Thomas Dedler </p>
<p>2013-04-15 </p>
<p>1.02.00 </p>
<p><b>&gt; </b></p>
<p>Configuration Hint chapter added </p>
<p><b>&gt; </b></p>
<p>Description of Post-Build Loadable </p>
<p>Thomas Dedler </p>
<p>2013-08-26 </p>
<p>1.03.00 </p>
<p><b>&gt; </b></p>
<p>Limitations of Single Channel Optimization </p>
<p>added </p>
<p><b>&gt; </b></p>
<p>Limitation of data length parameter added </p>
<p><b>&gt; </b></p>
<p>Dcm OnRequestDetection feature removed </p>
<p>Thomas Dedler </p>
<p>2014-04-10 </p>
<p>1.04.00 </p>
<p><b>&gt; </b></p>
<p>Synchronous / Asynchronous Transmission </p>
<p><b>&gt; </b></p>
<p>AR4.1.2 PduR API support </p>
<p>Thomas Dedler </p>
<p>2014-08-22 </p>
<p>2.00.00 </p>
<p><b>&gt; </b></p>
<p>SingleChannel optimization removed </p>
<p><b>&gt; </b></p>
<p>Support of CAN-FD added </p>
<p><b>&gt; </b></p>
<p>Application callbacks changed </p>
<p><b>&gt; </b></p>
<p>Postbuild-Build Selectable </p>
<p>Thomas Dedler </p>
<p>2015-01-12 </p>
<p>2.01.00 </p>
<p><b>&gt; </b></p>
<p>Missing description of CanTp_InitMemory() </p>
<p>added </p>
<p><b>&gt; </b></p>
<p>Reentrancy of CanTp_GetVersionInfo() </p>
<p>corrected </p>
<p><b>&gt; </b></p>
<p>Minor clarifications in regarding CAN-FD </p>
<p>Thomas Dedler </p>
<p>2015-07-01 </p>
<p>2.02.00 </p>
<p><b>&gt; </b></p>
<p>Separation Time by Application </p>
<p><b>&gt; </b></p>
<p>Dynamic BS feature description adapted </p>
<p>according to latest ISO specification </p>
<p>Thomas Dedler </p>
<p>2015-12-11 </p>
<p>3.00.00 </p>
<p><b>&gt; </b></p>
<p>Obsolete features removed: </p>
<p><b>&gt; </b></p>
<p>Notification of Failed Cancellations </p>
<p><b>&gt; </b></p>
<p>Ignore FC with invalid flow status </p>
<p><b>&gt; </b></p>
<p>Ignore FC with reserved STmin </p>
<p><b>&gt; </b></p>
<p>Ignore CF with wrong sequence number </p>
<p><b>&gt; </b></p>
<p>Clarification of performance parameter </p>
<p>configuration </p>
<p><b>&gt; </b></p>
<p>Rework of Critical Section chapter </p>
<p><b>&gt; </b></p>
<p>Hint for DET configuration added </p>
<p>Anthony Thomas </p>
<p>2016-08-05 </p>
<p>3.00.01 </p>
<p><b>&gt; </b></p>
<p>Updated document template </p>
<p><b>&gt; </b></p>
<p>Documented features, deviations and </p>
<p>extensions properly. </p>
<p>Anthony Thomas </p>
<p>2017-03-24 </p>
<p>3.01.00 </p>
<p><b>&gt; </b></p>
<p>Mixed11 address extension forwarding </p>
<p><b> </b></p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>3 </p>
<p>based on template version 5.7.1 </p>
<p><b>Reference Documents </b></p>
<p><b>No. </b></p>
<p><b>Source </b></p>
<p><b>Title </b></p>
<p><b>Version </b></p>
<p>[1]   </p>
<p>AUTOSAR </p>
<p>AUTOSAR_SWS_CANTransportLayer.pdf </p>
<p>4.0.0 </p>
<p>[2]   </p>
<p>AUTOSAR </p>
<p>AUTOSAR_SWS_CANInterface.pdf </p>
<p>5.0.0 </p>
<p>[3]   </p>
<p>AUTOSAR </p>
<p>AUTOSAR_SWS_PDURouter.pdf </p>
<p>3.2.0 </p>
<p>[4]   </p>
<p>ISO </p>
<p>/ISO/TF2/: ISO FDIS 15765-2; Road vehicles —  </p>
<p>Diagnostics on CAN — Part 2: Network layer services  </p>
<p>2015 </p>
<p>[5]   </p>
<p>AUTOSAR </p>
<p>AUTOSAR_SWS_DevelopmentErrorTracer.pdf </p>
<p>3.2.0 </p>
<p>[6]   </p>
<p>Vector </p>
<p>TechnicalReference_Asr_Dbg.pdf  </p>
<p>1.0.0 </p>
<p>[7]   </p>
<p>Vector </p>
<p>TechnicalReference_PostBuildLoadable.pdf </p>
<p>1.2.0 </p>
<p>[8]   </p>
<p>Vector </p>
<p>TechnicalReference_IdentityManager.pdf </p>
<p>1.0.0 </p>
<p>[9]   </p>
<p>Vector </p>
<p>TechnicalReference_Det.pdf </p>
<p>2.0.4 </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>4 </p>
<p>based on template version 5.7.1 </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>We have configured the programs in accordance with your specifications in the </p>
<p>questionnaire. Whereas the programs do support other configurations than the one </p>
<p>specified in your questionnaire, Vector´s release of the programs delivered to your </p>
<p>company is expressly restricted to the configuration you have specified in the </p>
<p>questionnaire. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>This symbol calls your attention to warnings. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>5 </p>
<p>based on template version 5.7.1 </p>
<p><b>Contents </b></p>
<p><b>1</b></p>
<p> </p>
<p><b>Component History ...................................................................................................... 9</b></p>
<p> </p>
<p><b>2</b></p>
<p> </p>
<p><b>Introduction................................................................................................................. 10</b></p>
<p> </p>
<p>2.1</p>
<p> </p>
<p>Architecture Overview ...................................................................................... 11</p>
<p> </p>
<p><b>3</b></p>
<p> </p>
<p><b>Functional Description ............................................................................................... 13</b></p>
<p> </p>
<p>3.1</p>
<p> </p>
<p>Features .......................................................................................................... 13</p>
<p> </p>
<p>3.1.1</p>
<p> </p>
<p>Deviations ........................................................................................ 13</p>
<p> </p>
<p>3.1.2</p>
<p> </p>
<p>Additions/ Extensions ....................................................................... 14</p>
<p> </p>
<p>3.1.2.1</p>
<p> </p>
<p>Split CanTp_MainFunction ............................................. 14</p>
<p> </p>
<p>3.1.2.2</p>
<p> </p>
<p>Notification of Failed Buffer Request .............................. 14</p>
<p> </p>
<p>3.1.2.3</p>
<p> </p>
<p>Handling of FC Frames with a Reserved STmin ............ 14</p>
<p> </p>
<p>3.1.2.4</p>
<p> </p>
<p>Dynamic and Static BlockSize and STmin ..................... 15</p>
<p> </p>
<p>3.1.2.5</p>
<p> </p>
<p>Dynamic Channel Assignment ....................................... 15</p>
<p> </p>
<p>3.1.2.6</p>
<p> </p>
<p>Single Buffer Optimization .............................................. 15</p>
<p> </p>
<p>3.1.2.7</p>
<p> </p>
<p>Transmit Queue ............................................................. 16</p>
<p> </p>
<p>3.1.2.8</p>
<p> </p>
<p>Asynchronous and Synchronous behavior of </p>
<p>CanTp_Transmit ............................................................ 17</p>
<p> </p>
<p>3.1.2.9</p>
<p> </p>
<p>Support of PduR Interface according to AUTOSAR </p>
<p>4.1.2 .............................................................................. 17</p>
<p> </p>
<p>3.1.2.10</p>
<p> </p>
<p>CAN-FD Support ............................................................ 18</p>
<p> </p>
<p>3.1.2.10.1</p>
<p> </p>
<p>CAN Messages with more than 8 Byte ....... 18</p>
<p> </p>
<p>3.1.2.10.2</p>
<p> </p>
<p>CAN-FD Frame Padding ............................ 19</p>
<p> </p>
<p>3.1.2.10.3</p>
<p> </p>
<p>Segmented Messages with more than </p>
<p>4095 Byte .................................................. 19</p>
<p> </p>
<p>3.1.2.11</p>
<p> </p>
<p>Separation Time by Application ...................................... 20</p>
<p> </p>
<p>3.1.2.12</p>
<p> </p>
<p>Mixed11 address extension forwarding .......................... 21</p>
<p> </p>
<p>3.2</p>
<p> </p>
<p>Limitations........................................................................................................ 21</p>
<p> </p>
<p>3.2.1</p>
<p> </p>
<p>Memory Optimization ....................................................................... 21</p>
<p> </p>
<p>3.2.2</p>
<p> </p>
<p>Channel Assignment ........................................................................ 21</p>
<p> </p>
<p>3.2.3</p>
<p> </p>
<p>Channel Addressing ......................................................................... 22</p>
<p> </p>
<p>3.2.4</p>
<p> </p>
<p>Data Length Parameter .................................................................... 22</p>
<p> </p>
<p>3.3</p>
<p> </p>
<p>Initialization ...................................................................................................... 22</p>
<p> </p>
<p>3.4</p>
<p> </p>
<p>States .............................................................................................................. 22</p>
<p> </p>
<p>3.5</p>
<p> </p>
<p>Main Functions ................................................................................................ 23</p>
<p> </p>
<p>3.6</p>
<p> </p>
<p>Error Handling .................................................................................................. 24</p>
<p> </p>
<p>3.6.1</p>
<p> </p>
<p>Development Error Reporting ........................................................... 24</p>
<p> </p>
<p>3.6.1.1</p>
<p> </p>
<p>Parameter Checking ...................................................... 27</p>
<p> </p>
<p>3.6.2</p>
<p> </p>
<p>Production Code Error Reporting ..................................................... 27</p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>6 </p>
<p>based on template version 5.7.1 </p>
<p>3.7</p>
<p> </p>
<p>Channel Mode ................................................................................................. 28</p>
<p> </p>
<p>3.8</p>
<p> </p>
<p>Connection Channels ....................................................................................... 28</p>
<p> </p>
<p>3.9</p>
<p> </p>
<p>Connection Timings ......................................................................................... 29</p>
<p> </p>
<p>3.9.1</p>
<p> </p>
<p>Timing Parameters ........................................................................... 29</p>
<p> </p>
<p>3.9.2</p>
<p> </p>
<p>Timing Considerations and Jitter ...................................................... 30</p>
<p> </p>
<p>3.9.2.1</p>
<p> </p>
<p>Jitter ............................................................................... 30</p>
<p> </p>
<p>3.9.2.2</p>
<p> </p>
<p>Separation Time ............................................................. 30</p>
<p> </p>
<p>3.9.2.3</p>
<p> </p>
<p>Implementation of N_Br ................................................. 31</p>
<p> </p>
<p><b>4</b></p>
<p> </p>
<p><b>Integration ................................................................................................................... 32</b></p>
<p> </p>
<p>4.1</p>
<p> </p>
<p>Scope of Delivery ............................................................................................. 32</p>
<p> </p>
<p>4.1.1</p>
<p> </p>
<p>Static Files ....................................................................................... 32</p>
<p> </p>
<p>4.1.2</p>
<p> </p>
<p>Dynamic Files .................................................................................. 32</p>
<p> </p>
<p>4.2</p>
<p> </p>
<p>Include Structure .............................................................................................. 33</p>
<p> </p>
<p>4.3</p>
<p> </p>
<p>Compiler Abstraction and Memory Mapping ..................................................... 34</p>
<p> </p>
<p>4.3.1</p>
<p> </p>
<p>Memory mapping rules ..................................................................... 34</p>
<p> </p>
<p>4.4</p>
<p> </p>
<p>Critical Sections ............................................................................................... 35</p>
<p> </p>
<p>4.5</p>
<p> </p>
<p>Buffer Configuration ......................................................................................... 35</p>
<p> </p>
<p>4.5.1</p>
<p> </p>
<p>Constant Block Size ......................................................................... 35</p>
<p> </p>
<p>4.5.2</p>
<p> </p>
<p>Zero Block Size ................................................................................ 36</p>
<p> </p>
<p>4.5.3</p>
<p> </p>
<p>Zero WFTmax .................................................................................. 36</p>
<p> </p>
<p>4.5.4</p>
<p> </p>
<p>Zero STmin ...................................................................................... 36</p>
<p> </p>
<p><b>5</b></p>
<p> </p>
<p><b>API Description ........................................................................................................... 37</b></p>
<p> </p>
<p>5.1</p>
<p> </p>
<p>Services provided by CanTp ............................................................................ 37</p>
<p> </p>
<p>5.1.1</p>
<p> </p>
<p>CanTp_InitMemory........................................................................... 37</p>
<p> </p>
<p>5.1.2</p>
<p> </p>
<p>CanTp_Init() ..................................................................................... 38</p>
<p> </p>
<p>5.1.3</p>
<p> </p>
<p>CanTp_Shutdown() .......................................................................... 38</p>
<p> </p>
<p>5.1.4</p>
<p> </p>
<p>CanTp_MainFunction() .................................................................... 39</p>
<p> </p>
<p>5.1.5</p>
<p> </p>
<p>CanTp_MainFunctionRx() ................................................................ 39</p>
<p> </p>
<p>5.1.6</p>
<p> </p>
<p>CanTp_MainFunctionTx() ................................................................ 40</p>
<p> </p>
<p>5.1.7</p>
<p> </p>
<p>CanTp_GetVersionInfo() .................................................................. 40</p>
<p> </p>
<p>5.1.8</p>
<p> </p>
<p>CanTp_Transmit() ............................................................................ 41</p>
<p> </p>
<p>5.1.9</p>
<p> </p>
<p>CanTp_CancelReceive() .................................................................. 42</p>
<p> </p>
<p>5.1.10</p>
<p> </p>
<p>CanTp_CancelTransmit() ................................................................. 43</p>
<p> </p>
<p>5.1.11</p>
<p> </p>
<p>CanTp_ChangeParameter() ............................................................. 44</p>
<p> </p>
<p>5.1.12</p>
<p> </p>
<p>CanTp_ReadParameter() ................................................................. 45</p>
<p> </p>
<p>5.2</p>
<p> </p>
<p>Services used by CanTp .................................................................................. 46</p>
<p> </p>
<p>5.3</p>
<p> </p>
<p>Callback Functions ........................................................................................... 47</p>
<p> </p>
<p>5.3.1</p>
<p> </p>
<p>CanTp_RxIndication() ...................................................................... 47</p>
<p> </p>
<p>5.3.2</p>
<p> </p>
<p>CanTp_TxConfirmation() .................................................................. 47</p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>7 </p>
<p>based on template version 5.7.1 </p>
<p>5.3.3</p>
<p> </p>
<p>CanTp_StopSeparationTime() .......................................................... 48</p>
<p> </p>
<p>5.4</p>
<p> </p>
<p>Configurable Interfaces .................................................................................... 48</p>
<p> </p>
<p>5.4.1</p>
<p> </p>
<p>Appl_StartSeparationTime() ............................................................. 48</p>
<p> </p>
<p>5.4.2</p>
<p> </p>
<p>Notification Functions ....................................................................... 49</p>
<p> </p>
<p>5.4.2.1</p>
<p> </p>
<p>Appl_CanTpRxSFIndication() ........................................ 49</p>
<p> </p>
<p>5.4.2.2</p>
<p> </p>
<p>Appl_CanTpRxFFIndication() ......................................... 49</p>
<p> </p>
<p>5.4.2.3</p>
<p> </p>
<p>Appl_CanTpRxCFIndication() ........................................ 50</p>
<p> </p>
<p>5.4.2.4</p>
<p> </p>
<p>Appl_CanTpFrameTransmission () ................................ 50</p>
<p> </p>
<p>5.4.2.5</p>
<p> </p>
<p>Appl_CanTpFrameTxConfirmation () ............................. 51</p>
<p> </p>
<p><b>6</b></p>
<p> </p>
<p><b>Configuration .............................................................................................................. 52</b></p>
<p> </p>
<p>6.1</p>
<p> </p>
<p>Configuration Variants ...................................................................................... 52</p>
<p> </p>
<p>6.2</p>
<p> </p>
<p>Configuration of Post-Build .............................................................................. 52</p>
<p> </p>
<p>6.3</p>
<p> </p>
<p>Additional Configuration Hints .......................................................................... 53</p>
<p> </p>
<p>6.3.1</p>
<p> </p>
<p>CanIf Tx Buffering ............................................................................ 53</p>
<p> </p>
<p>6.3.2</p>
<p> </p>
<p>ISO Performance Requirements ...................................................... 53</p>
<p> </p>
<p><b>7</b></p>
<p> </p>
<p><b>Glossary and Abbreviations ...................................................................................... 54</b></p>
<p> </p>
<p>7.1</p>
<p> </p>
<p>Glossary .......................................................................................................... 54</p>
<p> </p>
<p>7.2</p>
<p> </p>
<p>Abbreviations ................................................................................................... 56</p>
<p> </p>
<p><b>8</b></p>
<p> </p>
<p><b>Contact ........................................................................................................................ 58</b></p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>8 </p>
<p>based on template version 5.7.1 </p>
<p><b>Illustrations </b></p>
<p>Figure 2-1</p>
<p> </p>
<p>AUTOSAR 4.x Architecture Overview ....................................................... 11</p>
<p> </p>
<p>Figure 2-2</p>
<p> </p>
<p>Interfaces to adjacent modules of the CanTp ............................................ 12</p>
<p> </p>
<p>Figure 3-1</p>
<p> </p>
<p>Sequence Diagram: Asynchronous Transmission ..................................... 17</p>
<p> </p>
<p>Figure 3-2</p>
<p> </p>
<p>Sequence Diagram: Synchronous Transmission ....................................... 17</p>
<p> </p>
<p>Figure 3-3</p>
<p> </p>
<p>Separation Time by Application ................................................................. 20</p>
<p> </p>
<p>Figure 3-4</p>
<p> </p>
<p>Channel Assignment for N-SDUs and N-PDUs ......................................... 22</p>
<p> </p>
<p>Figure 3-5</p>
<p> </p>
<p>CanTp internal states ................................................................................ 23</p>
<p> </p>
<p>Figure 3-6</p>
<p> </p>
<p>Connection Timing .................................................................................... 29</p>
<p> </p>
<p>Figure 4-1</p>
<p> </p>
<p>Include structure ....................................................................................... 33</p>
<p> </p>
<p><b> </b></p>
<p><b>Tables </b></p>
<p>Table 1-1 </p>
<p> </p>
<p>Component History ..................................................................................... 9</p>
<p> </p>
<p>Table 3-1 </p>
<p> </p>
<p>Supported AUTOSAR standard conform features ..................................... 13</p>
<p> </p>
<p>Table 3-2 </p>
<p> </p>
<p>Not supported AUTOSAR standard conform features ............................... 13</p>
<p> </p>
<p>Table 3-3 </p>
<p> </p>
<p>Features provided beyond the AUTOSAR standard .................................. 14</p>
<p> </p>
<p>Table 3-4 </p>
<p> </p>
<p>PduR API changes between AR4.0.3 and 4.1.2 ........................................ 18</p>
<p> </p>
<p>Table 3-5 </p>
<p> </p>
<p>Service IDs ............................................................................................... 24</p>
<p> </p>
<p>Table 3-6 </p>
<p> </p>
<p>Errors reported to DET ............................................................................. 25</p>
<p> </p>
<p>Table 3-7 </p>
<p> </p>
<p>Development Error Reporting: Assignment of checks to services ............. 27</p>
<p> </p>
<p>Table 3-8 </p>
<p> </p>
<p>Connection Timing Parameters ................................................................. 29</p>
<p> </p>
<p>Table 3-9 </p>
<p> </p>
<p>Examples for requested and observed separation times ........................... 31</p>
<p> </p>
<p>Table 4-1 </p>
<p> </p>
<p>Static files ................................................................................................. 32</p>
<p> </p>
<p>Table 4-2 </p>
<p> </p>
<p>Generated files ......................................................................................... 32</p>
<p> </p>
<p>Table 4-3 </p>
<p> </p>
<p>Compiler abstraction and memory mapping .............................................. 34</p>
<p> </p>
<p>Table 5-1 </p>
<p> </p>
<p>CanTp_InitMemory ................................................................................... 37</p>
<p> </p>
<p>Table 5-2 </p>
<p> </p>
<p>CanTp_Init().............................................................................................. 38</p>
<p> </p>
<p>Table 5-3 </p>
<p> </p>
<p>CanTp_Shutdown()................................................................................... 38</p>
<p> </p>
<p>Table 5-4 </p>
<p> </p>
<p>CanTp_MainFunction() ............................................................................. 39</p>
<p> </p>
<p>Table 5-5 </p>
<p> </p>
<p>CanTp_MainFunctionRx() ......................................................................... 39</p>
<p> </p>
<p>Table 5-6 </p>
<p> </p>
<p>CanTp_MainFunctionTx() ......................................................................... 40</p>
<p> </p>
<p>Table 5-7 </p>
<p> </p>
<p>CanTp_GetVersionInfo() ........................................................................... 40</p>
<p> </p>
<p>Table 5-8 </p>
<p> </p>
<p>CanTp_Transmit() ..................................................................................... 41</p>
<p> </p>
<p>Table 5-9 </p>
<p> </p>
<p>CanTp_CancelReceive() .......................................................................... 42</p>
<p> </p>
<p>Table 5-10 </p>
<p> </p>
<p>CanTp_CancelTransmit() .......................................................................... 43</p>
<p> </p>
<p>Table 5-11 </p>
<p> </p>
<p>CanTp_ChangeParameter() ..................................................................... 44</p>
<p> </p>
<p>Table 5-12 </p>
<p> </p>
<p>CanTp_ReadParameter() ......................................................................... 45</p>
<p> </p>
<p>Table 5-13 </p>
<p> </p>
<p>Services used by the CanTp ..................................................................... 46</p>
<p> </p>
<p>Table 5-14 </p>
<p> </p>
<p>CanTp_RxIndication() ............................................................................... 47</p>
<p> </p>
<p>Table 5-15 </p>
<p> </p>
<p>CanTp_TxConfirmation() .......................................................................... 47</p>
<p> </p>
<p>Table 5-16 </p>
<p> </p>
<p>CanTp_StopSeparationTime() .................................................................. 48</p>
<p> </p>
<p>Table 5-17 </p>
<p> </p>
<p>Appl_StartSeparationTime()...................................................................... 48</p>
<p> </p>
<p>Table 5-18 </p>
<p> </p>
<p>Appl_CanTpRxSFIndication() ................................................................... 49</p>
<p> </p>
<p>Table 5-19 </p>
<p> </p>
<p>Appl_CanTpRxFFIndication() ................................................................... 49</p>
<p> </p>
<p>Table 5-20 </p>
<p> </p>
<p>Appl_CanTpRxCFIndication() ................................................................... 50</p>
<p> </p>
<p>Table 5-21 </p>
<p> </p>
<p>Appl_CanTpFrameTransmission () ........................................................... 50</p>
<p> </p>
<p>Table 5-22 </p>
<p> </p>
<p>Appl_CanTpFrameTransmission () ........................................................... 51</p>
<p> </p>
<p>Table 6-1 </p>
<p> </p>
<p>Example for typical timing parameter specification.................................... 53</p>
<p> </p>
<p>Table 7-1 </p>
<p> </p>
<p>Glossary ................................................................................................... 56</p>
<p> </p>
<p>Table 7-2 </p>
<p> </p>
<p>Abbreviations ............................................................................................ 57</p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>9 </p>
<p>based on template version 5.7.1 </p>
<p><b>1 </b></p>
<p><b>Component History </b></p>
<p>The </p>
<p>component </p>
<p>history </p>
<p>gives </p>
<p>an </p>
<p>overview </p>
<p>over </p>
<p>the </p>
<p>important </p>
<p>milestones </p>
<p>that </p>
<p>are </p>
<p>supported in the different versions of the component.  </p>
<p><b>Component Version </b></p>
<p><b>New Features </b></p>
<p>1.00 </p>
<p>Initial implementation of CanTp according to AR4.0.3 </p>
<p>1.01 </p>
<p>Synchronous transmission feature removed due to PduR compatibility </p>
<p>1.02 </p>
<p>Debugging Concept </p>
<p>Post-Build Loadable </p>
<p>2.00 </p>
<p>Generator changed to Java7 </p>
<p>2.01 </p>
<p>Generator framework supports AR4.1.2 schema </p>
<p>2.02 </p>
<p>Synchronous transmission re-introduced (now supported by PduR) </p>
<p>Support for AR4.1.2 PduR APIs </p>
<p>3.00 </p>
<p>Post-Build Selectable </p>
<p>CAN-FD support </p>
<p>3.01 </p>
<p>SafeBSW Step I </p>
<p>3.02 </p>
<p>SafeBSW Step II </p>
<p>Separation Time by Application </p>
<p>4.00 </p>
<p>SafeBSW Step III </p>
<p>4.01 </p>
<p>SafeBSW Step IV </p>
<p>4.02 </p>
<p>First SafeBSW release </p>
<p>4.03 </p>
<p>Mixed11 address extension forwarding </p>
<p>Table 1-1  </p>
<p>Component History </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>10 </p>
<p>based on template version 5.7.1 </p>
<p><b>2 </b></p>
<p><b>Introduction </b></p>
<p>This document describes the functionality, API and configuration of the AUTOSAR BSW </p>
<p>module CanTp as specified in [1].  </p>
<p> </p>
<p><b>Supported AUTOSAR Release: </b></p>
<p>4 </p>
<p><b>Supported Configuration Variants: </b></p>
<p>pre-compile, post-build-loadable, post-build-selectable </p>
<p><b>Vendor ID: </b></p>
<p>CANTP_VENDOR_ID </p>
<p>30 decimal </p>
<p>(= Vector-Informatik, </p>
<p>according to HIS) </p>
<p><b>Module ID: </b></p>
<p>CANTP_MODULE_ID   </p>
<p>35 decimal </p>
<p>(according to ref. [1]) </p>
<p> </p>
<p> </p>
<p>According to AUTOSAR basic software architecture, CanTp provides services for </p>
<p><b>&gt; </b> Segmentation of data in transmit direction </p>
<p><b>&gt; </b> Reassembly of data in receive direction </p>
<p><b>&gt; </b> Control of data flow </p>
<p><b>&gt; </b> Detection of errors in segmentation sessions </p>
<p> </p>
<p>AUTOSAR module  specifications are  based  on  existing  standards. Thus  this AUTOSAR </p>
<p>CAN Transport Layer specification is based on the international standard ISO 15765 which </p>
<p>is the most widespread standard in the automotive domain. </p>
<p>ISO  15765  contains  four  sections  and  describes  two  applicable  CAN  Transport  Layer </p>
<p>specifications: ISO 15765-2 for OEM enhanced diagnostics (see [4]) and ISO 15765-4 for </p>
<p>OBD diagnostics. Concerning the transport layer, ISO 15765-4 (the section of ISO 15765 </p>
<p>which  also  covers  the  data  link  layer  and  the  physical  layer)  is  in  accordance  with  ISO </p>
<p>15765-2 with some restrictions/additions. In order that there is no incompatibility problem </p>
<p>between ISO 15765-2 and ISO 15765-4, differences will be solved by the CAN Transport </p>
<p>Layer configuration. </p>
<p>Although the CAN transport protocol is mainly used for vehicle diagnostic systems, its </p>
<p>design also incorporates requirements from other CAN based systems employing </p>
<p>transport layer protocols. </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>11 </p>
<p>based on template version 5.7.1 </p>
<p><b>2.1 </b></p>
<p><b>Architecture Overview </b></p>
<p>The following figure shows where the CanTp is located in the AUTOSAR architecture. </p>
<p> </p>
<p>Figure 2-1 </p>
<p>AUTOSAR 4.x Architecture Overview   </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>12 </p>
<p>based on template version 5.7.1 </p>
<p>The next figure shows the interfaces to adjacent modules of the CanTp. These interfaces </p>
<p>are described in chapter 5.  </p>
<p> </p>
<p>Figure 2-2 </p>
<p>Interfaces to adjacent modules of the CanTp </p>
<p><b> cmp Interfaces Ov erv iew</b></p>
<p><b>CanTp</b></p>
<p><b>CanIf</b></p>
<p><b>Det</b></p>
<p><b>SchM</b></p>
<p><b>EcuM</b></p>
<p><b>PduR</b></p>
<p><b>Dcm</b></p>
<p>PduR_CanTpStartOfReception</p>
<p>CanTp_ReadParameter</p>
<p>CanTp_CancelTransmit</p>
<p>CanTp_Transmit</p>
<p>CanTp_ChangeParameter</p>
<p>CanTp_GetVersionInfo</p>
<p>CanTp_MainFunction</p>
<p>CanTp_Init / CanTp_Shutdown</p>
<p>CanTp_TxConfirmation</p>
<p>CanTp_CancelReceive</p>
<p>PduR_CanTpTxConfirmation</p>
<p>Dcm_OnRequestDetection</p>
<p>PduR_CanTpCopyRxData</p>
<p>PduR_CanTpRxIndication</p>
<p>PduR_CanTpCopyTxData</p>
<p>SchM_Enter_CanTp</p>
<p>SchM_Exit_CanTp</p>
<p>CanIf_Transmit</p>
<p>CanIf_CancelTransmit</p>
<p>Det_ReportError</p>
<p>CanTp_RxIndication</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>13 </p>
<p>based on template version 5.7.1 </p>
<p><b>3 </b></p>
<p><b>Functional Description </b></p>
<p><b>3.1 </b></p>
<p><b>Features </b></p>
<p>The features listed in the following tables cover the complete functionality specified for the </p>
<p>CanTp. </p>
<p>The AUTOSAR  standard  functionality  is  specified  in  [1],  the  corresponding  features  are </p>
<p>listed in the tables </p>
<p><b>&gt; </b></p>
<p>Table 3-1   Supported AUTOSAR standard conform features </p>
<p><b>&gt; </b></p>
<p>Table 3-2   Not supported AUTOSAR standard conform features </p>
<p>Vector  Informatik  provides  further  CanTp  functionality  beyond  the  AUTOSAR  standard. </p>
<p>The corresponding features are listed in the table </p>
<p><b>&gt; </b></p>
<p>Table 3-3   Features provided beyond the AUTOSAR standard </p>
<p>The following features specified in [1] are supported: </p>
<p><b>Supported AUTOSAR Standard Conform Features </b></p>
<p>Segmented and unsegmented data transmission </p>
<p>Segmented and unsegmented data reception </p>
<p>Control of data flow </p>
<p>Supervision of timeouts </p>
<p>Detection of errors during segemented communication </p>
<p>Transmission cancellation </p>
<p>Reception cancellation </p>
<p><b>Post-Build Loadable </b></p>
<p><b>MICROSAR Identity Manager using Post-Build Selectable </b></p>
<p>Table 3-1  </p>
<p>Supported AUTOSAR standard conform features </p>
<p><b>3.1.1 </b></p>
<p><b>Deviations </b></p>
<p>The following features specified in [1] are not or only partly supported: </p>
<p><b>Category </b></p>
<p><b>Description </b></p>
<p><b>ASR </b></p>
<p><b>Version </b></p>
<p>Functional </p>
<p>8.3.4  CanTp_Transmit: For robustness reasons (e.g. in case of delayed </p>
<p>buffer provision), the CanTp internally stores the frames to be transmitted. </p>
<p>4.0.3 </p>
<p>API </p>
<p>8.3.2  CanTp_ GetVersionInfo: The function is always implemented as a </p>
<p>regular function.</p>
<p> </p>
<p>4.0.3 </p>
<p>Table 3-2  </p>
<p>Not supported AUTOSAR standard conform features </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>14 </p>
<p>based on template version 5.7.1 </p>
<p><b>3.1.2 </b></p>
<p><b>Additions/ Extensions </b></p>
<p>The following features are provided beyond the AUTOSAR standard: </p>
<p><b>Features Provided Beyond The AUTOSAR Standard </b></p>
<p>Split MainFunction </p>
<p>Notification of Failed Buffer Request  </p>
<p>Handling of FC Frames with a Reserved STmin </p>
<p>Dynamic Channel Assignment </p>
<p>Single Buffer Optimization  </p>
<p>Transmit Queue </p>
<p>Synchronous Transmission </p>
<p>CAN-FD Support </p>
<p>Separation Time by Application </p>
<p>Mixed11 address extension forwarding </p>
<p>Table 3-3  </p>
<p>Features provided beyond the AUTOSAR standard </p>
<p><b>3.1.2.1 </b></p>
<p><b>Split CanTp_MainFunction </b></p>
<p>In extension to the CanTp SWS [1] the Vector CanTp supports two additional API functions </p>
<p>(</p>
<p>CanTp_MainFunctionRx</p>
<p> and </p>
<p>CanTp_MainFunctionTx</p>
<p>) in case a split main function </p>
<p>is  configured. These  additional  functions  can  be  used  instead  of  the  original AUTOSAR </p>
<p>CanTp_MainFunction</p>
<p> API (which is still supported) to optimize the calling sequence of </p>
<p>incoming requests and their responses. </p>
<p>Configuration attribute: CanTpEnableSplitMainFunction </p>
<p> </p>
<p> </p>
<p><b>3.1.2.2 </b></p>
<p><b>Notification of Failed Buffer Request </b></p>
<p>If </p>
<p>the </p>
<p>call </p>
<p>to </p>
<p>CanTpStartOfReception</p>
<p> </p>
<p>returns </p>
<p>BUFREQ_E_NOT_OK </p>
<p>or </p>
<p>BUFREQ_E_OVFL, </p>
<p>according </p>
<p>to </p>
<p>AUTOSAR </p>
<p>the </p>
<p>connection </p>
<p>shall </p>
<p>be </p>
<p>terminated. </p>
<p>Additionally each terminated reception shall be notified to the upper layer. However, in the </p>
<p>mentioned  case  the  upper  layer  already  rejected  the  reception  by  returning  an  invalid </p>
<p>buffer status. Therefore no additional notification by the CanTp may be required. </p>
<p>In  the  Vector  CanTp, this behavior  is configurable.  If  the  related  switch  is  activated, the </p>
<p>notification </p>
<p>is </p>
<p>only </p>
<p>performed </p>
<p>if </p>
<p>at </p>
<p>least </p>
<p>one </p>
<p>valid </p>
<p>buffer </p>
<p>(BUFREQ_OK </p>
<p>or </p>
<p>BUFREQ_E_BUSY) have been provided. </p>
<p>Configuration attribute: CanTpOnlyNotifyInformedAppl </p>
<p> </p>
<p> </p>
<p><b>3.1.2.3 </b></p>
<p><b>Handling of FC Frames with a Reserved STmin </b></p>
<p>When  using  the  standard  implementation  according  to  ISO  157675-2,  the  CanTp  must </p>
<p>accept  reserved  STmin  values  (0x80  ...  0xF0,  0xFA  ...  0xFF);  the  connection  is  then </p>
<p>processed with the slowest value for STmin (127msec). </p>
<p>In the CanTp, it can be configured to cancel the transmission instead. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>15 </p>
<p>based on template version 5.7.1 </p>
<p>Configuration attribute:  CanTpRejectFcWithReservedStMin </p>
<p> </p>
<p><b>3.1.2.4 </b></p>
<p><b>Dynamic and Static BlockSize and STmin </b></p>
<p>In AUTOSAR 4 and in older ISO specifications, the block size and the STmin values of the </p>
<p>first Flow Control shall be used throughout the whole connection (CANTP067). </p>
<p>ISO 15765-2:20215 ([4]) supports both dynamic and static flow control parameters. In the </p>
<p>CanTp, the desired behavior can be configured as follows: </p>
<p><b>&gt; </b></p>
<p>For Rx connections, the block size can be configured to be constant until the end of </p>
<p>the reception. It is then calculated once after receiving the FF, based on the configured </p>
<p>maximum block size and the available buffer (default). When using the alternative </p>
<p>behavior, the block size is re-calculated whenever a Flow Control have to be </p>
<p>transmitted. For STmin, always the configured value is used. </p>
<p>Configuration attribute: CanTpEnableConstantBS </p>
<p><b>&gt; </b></p>
<p>For Tx connections it can be configured if the CanTp shall either evaluate only the first </p>
<p>or all Flow Control frames. </p>
<p>Configuration attribute: CanTpUseOnlyFirstFc </p>
<p> </p>
<p><b>3.1.2.5 </b></p>
<p><b>Dynamic Channel Assignment </b></p>
<p>According  to  AUTOSAR,  each  N-SDU  shall  be  assigned  statically  to  one  connection </p>
<p>channel. Since not always all N-SDUs need to be processed simultaneously, the  CanTp </p>
<p>provides the possibility to limit the number of channels that can be used in parallel. In this </p>
<p>case,  N-SDUs  are  dynamically  assigned  to  a  channel  during  runtime.  If  no  channel  is </p>
<p>available, the reception / transmission is rejected. </p>
<p>This  reduces  resource  consumption,  as  the  memory  needed  to  handle  reception  or </p>
<p>transmission </p>
<p>is </p>
<p>shared </p>
<p>between  multiple </p>
<p>N-SDUs. </p>
<p>However, </p>
<p>it </p>
<p>adds  a </p>
<p>little </p>
<p>runtime </p>
<p>overhead for channel management. </p>
<p>Configuration attribute: CanTpDynamicChannelAssignment </p>
<p> </p>
<p><b>3.1.2.6 </b></p>
<p><b>Single Buffer Optimization </b></p>
<p>According  to  AUTOSAR,  the  CanTp  must  include  a  handling  for  segmented  receive </p>
<p>buffers,  i.e.  it  is  allowed  that </p>
<p>CanTpStartOfReception</p>
<p>  returns  a  smaller  buffer  than </p>
<p>overall data length specified in the first frame. The CanTp will then request an additional </p>
<p>buffer during reception. </p>
<p>For  diagnostic  applications,  often  only  one  buffer is  provided  at  the  beginning  where  its </p>
<p>size is sufficient to store the complete message. Therefore no additional buffer must be </p>
<p>requested by the CanTp. </p>
<p>If  it  can  be  ensured  that  always  only  one  single  buffer  is  used,  the  CanTp  provides  a </p>
<p>configuration switch to remove the code to handle segmented buffers. This will reduce size </p>
<p>and runtime. </p>
<p>Configuration attributes:  CanTpOptimizeSingleRxBuffer  </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>16 </p>
<p>based on template version 5.7.1 </p>
<p><b>3.1.2.7 </b></p>
<p><b>Transmit Queue </b></p>
<p>If an N-PDU is used by different connections and more than one connection requests the </p>
<p>CanIf to transmit this N-PDU at the same time, the subsequent TxConfirmation cannot be </p>
<p>uniquely assigned to the correct connection. </p>
<p>There may be two reasons why an N-PDU is used by different connections: </p>
<p><b>&gt; </b></p>
<p>A channel is configured as full duplex: the conflict occurs here if the Rx connection </p>
<p>tries to transmit an FC while the Tx connection is transmitting SF, FF or CFs. </p>
<p><b>&gt; </b></p>
<p>extended or mixed11 addressing is used: then one N-PDU can be used by multiple </p>
<p>channels, as the addressing information is part of the protocol data. However, this </p>
<p>protocol data is not available when the TxConfirmation is processed. </p>
<p>Currently AUTOSAR does not describe how to handle these cases. By default the CanTp </p>
<p>tracks for each N-PDU if a transmission is in progress or not. If a channel tries to transmit </p>
<p>an  N-PDU  that  is  in  use  by  another  N-SDU,  the  request  is  rejected  and  the  respective </p>
<p>channel will retry transmission on task level. </p>
<p>However,  the  more  often  such  conflicts  occur  (e.g.  if  many  N-SDUs  with  extended </p>
<p>addressing  use  the  same  N-PDU),  the  higher  is  the  risk  of  sporadically  unexpected </p>
<p>behavior like connection timeouts due to the delay caused by the retry on task level. To </p>
<p>eliminate  this  risk  and  to  optimize  the  throughput  performance,  the </p>
<p>CanTp </p>
<p>can </p>
<p>be </p>
<p>configured </p>
<p>to </p>
<p>queue </p>
<p>the </p>
<p>transmit </p>
<p>requests </p>
<p>to </p>
<p>the </p>
<p>CanIf. </p>
<p>Entries </p>
<p>in </p>
<p>the </p>
<p>queue </p>
<p>are </p>
<p>transmitted as soon as the transmission of the previous N-PDU is completed. </p>
<p>The main drawback of this feature is increased memory consumption. </p>
<p>Configuration attributes: CanTpEnableTransmitQueue </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>The default transmit queue size is 4. To set a different queue size, the following line </p>
<p>must be added to a user config file: </p>
<p><b>#define </b>CANTP_TX_QUEUE_SIZE &lt;new size&gt;</p>
<p> </p>
<p>Please note that due to implementation reasons, only queue sizes with a power of two </p>
<p>are allowed (2, 4, 8, 16…). </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<p> </p>
<p><b> </b></p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>17 </p>
<p>based on template version 5.7.1 </p>
<p><b>3.1.2.8 </b></p>
<p><b>Asynchronous and Synchronous behavior of CanTp_Transmit </b></p>
<p>By default, the API CanTp_Transmit is asynchronous. This means it only prepares the </p>
<p>connection, while the request for the payload data to the upper layer and the transmission </p>
<p>of the first CAN frame will be done during the next task cycle. </p>
<p> </p>
<p>Figure 3-1 </p>
<p>Sequence Diagram: Asynchronous Transmission </p>
<p>The CanTp can be configured to make CanTp_Transmit synchronous. Then the payload </p>
<p>request to the upper layer and the transmit request to the CanIf are done in the context of </p>
<p>CanTp_Transmit. This will slightly improve transmission speed, but requires also that the </p>
<p>upper layer is able to handle calls to the CopyTxData function before CanTp_Transmit </p>
<p>returns. </p>
<p> </p>
<p>Figure 3-2 </p>
<p>Sequence Diagram: Synchronous Transmission </p>
<p>Configuration attributes: CanTpEnableSynchronousTransmit </p>
<p> </p>
<p><b>3.1.2.9 </b></p>
<p><b>Support of PduR Interface according to AUTOSAR 4.1.2 </b></p>
<p>Although the CanTp is not yet fully compliant with AUTOSAR 4.1.2, it already supports the </p>
<p>PduR API signatures according to the updated revision. </p>
<p>The following changes have been made by AUTOSAR in the interface between CanTp </p>
<p>and PduR: </p>
<p><b>&gt; </b></p>
<p>PduR_CanTpStartOfReception</p>
<p>: pointer to PduInfoType as additional parameter </p>
<p>added for meta data support (currently not supported by CanTp; will be set to NULL) </p>
<p><b>&gt; </b></p>
<p>PduR_CanTpRxIndication</p>
<p>, </p>
<p>PduR_CanTpTxConfirmation</p>
<p>: type of the Result </p>
<p>parameter changed from NotifResultType to Std_ReturnType </p>
<p> </p>
<p>CanTp</p>
<p>PduR</p>
<p>CanIf</p>
<p>CanTp_Transmit()</p>
<p>PduR_CanTpCopyTxData()</p>
<p>CanIf_Transmit()</p>
<p>CanTp</p>
<p>PduR</p>
<p>CanIf</p>
<p>CanTp_Transmit()</p>
<p>PduR_CanTpCopyTxData()</p>
<p>CanIf_Transmit()</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>18 </p>
<p>based on template version 5.7.1 </p>
<p><b>PduR API Changes </b></p>
<p>AUTOSAR 4.0.3 </p>
<p>BufReq_ReturnType <b>PduR_CanTpStartOfReception</b>( PduIdType id,  </p>
<p>                                              PduLengthType TpSduLength, </p>
<p>                                              PduLengthType* bufferSizePtr ); </p>
<p>void <b>PduR_CanTpRxIndication</b>( PduIdType CanTpRxPduId,  </p>
<p>                             NotifResultType Result ); </p>
<p>void <b>PduR_CanTpTxConfirmation</b>( PduIdType CanTpTxPduId,  </p>
<p>                               NotifResultType Result ); </p>
<p>AUTOSAR 4.1.2 </p>
<p>BufReq_ReturnType <b>PduR_CanTpStartOfReception</b>( PduIdType id,  </p>
<p>                                              PduInfoType * PduInfoPtr, </p>
<p>                                              PduLengthType TpSduLength, </p>
<p>                                              PduLengthType* bufferSizePtr ); </p>
<p>void <b>PduR_CanTpRxIndication</b>( PduIdType CanTpRxPduId,  </p>
<p>                             Std_ReturnType Result ); </p>
<p>void <b>PduR_CanTpTxConfirmation</b>(PduIdType CanTpTxPduId,  </p>
<p>                              Std_ReturnType Result ); </p>
<p>Table 3-4  </p>
<p>PduR API changes between AR4.0.3 and 4.1.2 </p>
<p>With a Vector PduR, the DaVinci Configurator Pro 5 will automatically detect the PduR </p>
<p>version and activate the appropriate API signature. </p>
<p>With a Non-Vector PduR in the stack, the AUTOSAR version must be set by providing one </p>
<p>of the following definitions (e.g. via compiler config): </p>
<p>AUTOSAR 4.0.3: </p>
<p>#define MSR_PDUR_API_AR_VERSION   0x403</p>
<p> </p>
<p>AUTOSAR 4.1.2: </p>
<p>#define MSR_PDUR_API_AR_VERSION   0x412 </p>
<p><b> </b></p>
<p><b>3.1.2.10 </b></p>
<p><b>CAN-FD Support </b></p>
<p>The CanTp supports the ISO 15765-2:2015, which not only introduces CAN-FD frames </p>
<p>with more than 8 byte payload, but also supports segmented transfers with more than </p>
<p>4095 byte. </p>
<p> </p>
<p><b>3.1.2.10.1 </b></p>
<p><b>CAN Messages with more than 8 Byte </b></p>
<p>CAN-FD frames support a higher bit rate in the data field of a CAN frame, as well as a </p>
<p>maximum length of up to 64 byte per frame. For the CanTp behavior, only the data length </p>
<p>is  relevant,  CAN-FD  frames  with  only  8  byte  are  treated  the  same  way  as  classic  CAN </p>
<p>frames.  </p>
<p>The maximum possible CAN DLC is configured by the PduLength parameter of a global </p>
<p>PDU in the ECUC: </p>
<p> </p>
<p>/EcuC/EcucPduCollection/Pdu/PduLength </p>
<p>To use CAN-FD for an N-SDU, all of the following configuration settings are required: </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>19 </p>
<p>based on template version 5.7.1 </p>
<p><b>&gt; </b></p>
<p>CanTpRxNPduRef / CanTpTxNPduRef must reference a global PDU with a </p>
<p>PduLength &gt; 8 </p>
<p><b>&gt; </b></p>
<p>CanTpRxTaType / CanTpTxTaType must be set to </p>
<p>CANTP_CANFD_FUNCTIONAL</p>
<p> or </p>
<p>CANTP_CANFD_PHYSICAL</p>
<p> </p>
<p><b>&gt; </b></p>
<p>The global switch CanTpFlexibleDataRateSupport must be enabled </p>
<p>The flow  control  N-PDU  references  are not taken  into  account,  as  these frames always </p>
<p>need less than 8 byte. It does not affect the CanTp behavior whether if they are configured </p>
<p>in the CanIf as CAN-FD or as classic CAN. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Reference</b> </p>
<p>For restrictions of the N-PDU usage on a channel, please also refer to chapter 3.2.2. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>3.1.2.10.2 </b></p>
<p><b>CAN-FD Frame Padding </b></p>
<p>With CAN-FD, not all DLCs between 8 and 64 are valid. A CanTp frame must always be </p>
<p>padded to the next valid DLC. The byte value which is used to fill up the frame is either </p>
<p>random or user defined, depending on the following configuration parameters: </p>
<p> </p>
<p>CanTp/CanTpGeneral/CanTpHavePaddingByte </p>
<p> </p>
<p>CanTp/CanTpGeneral/CanTpPaddingByte </p>
<p>The PaddingActivation setting, which can be configured globally and N-SDU specific, only </p>
<p>applies for frames which require a DLC less than 8 byte. </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p><b>&gt; </b></p>
<p>If a CanTp CAN-FD frame (PCI + payload) needs 6 byte, it is padded to 8 byte if </p>
<p>padding is active, but left at 6 byte if padding is disabled. </p>
<p><b>&gt; </b></p>
<p>If a CanTp CAN-FD frame (PCI + payload) needs 21 byte, it is always extended to </p>
<p>24 byte, which is the next valid CAN-FD length</p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>3.1.2.10.3 </b></p>
<p><b>Segmented Messages with more than 4095 Byte </b></p>
<p>ISO15765-2:2015  also  introduced  an  extended  first  frame  definition  (in  the  following </p>
<p>referred to as “long first frame”; LFF), which uses a data length of 32 bit. For backward </p>
<p>compatibility,  LFFs  are  only  used  if  the  overall  message  length  is  above  4095  byte. </p>
<p>Otherwise, the standard first frame format with 12 bit data length is used. </p>
<p>As the LFF does not depend on the length of the used N-PDUs, it can also be used with </p>
<p>classic  CAN  frames.  However,  for  ISO  compatibility  it  is  recommended  to  enable  this </p>
<p>functionality when using CAN-FD. </p>
<p>Configuration attribute: CanTpSupportLongFirstFrames </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>20 </p>
<p>based on template version 5.7.1 </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>In the ECUC module, the type of the global PduLength can be configured: </p>
<p> </p>
<p>/EcuC/EcucPduCollection/PduLengthTypeEnum </p>
<p>To use the full 32 bit data length of the LFF, it must be set to UINT32. </p>
<p>If set to UINT16, the maximum data length will be limited to 65535 byte and the CanTp </p>
<p>will reject received LFFs with a longer data length.  </p>
<p>For transmission requests, an overrun can’t be detected by the CanTp as the compiler </p>
<p>will already truncate the data length passed to CanTp_Transmit. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>3.1.2.11 </b></p>
<p><b>Separation Time by Application </b></p>
<p>The accuracy of the STmin calculated by the CanTp depends on its task cycle. If STmin </p>
<p>values are required which are in the range or below the CanTp task cycle time, this may </p>
<p>not be acceptable. </p>
<p>One solution may be to reduce the task cycle time. However, this is usually not satisfying </p>
<p>since it produces too high CPU load. An external timer (like in the OS or in hardware) can </p>
<p>be an alternative. </p>
<p>For this, the CanTp provides an optional call-out which notifies the application whenever </p>
<p>STmin need to be started. By the return value of the notification function, the application </p>
<p>can indicate whether to do STmin handling by itself, or leave it to the CanTp. </p>
<p>If the application accepts to handle the separation time, it has to set up a timer and call </p>
<p>CanTp_StopSeparationTime()</p>
<p> </p>
<p>when </p>
<p>the </p>
<p>timer </p>
<p>expired. </p>
<p>This </p>
<p>will </p>
<p>trigger </p>
<p>the </p>
<p>transmission of the next CF. </p>
<p>It </p>
<p>is </p>
<p>allowed </p>
<p>to </p>
<p>call </p>
<p>CanTp_StopSeparationTime()</p>
<p> </p>
<p>anytime </p>
<p>between </p>
<p>the </p>
<p>call </p>
<p>to </p>
<p>Appl_StartSeparationTime()</p>
<p> and before the end of the configured N_Cs time. Only </p>
<p>if N_Cs expires and the call-back has not been called yet, the CanTp will send the next CF </p>
<p>by </p>
<p>itself </p>
<p>to </p>
<p>fulfill </p>
<p>the </p>
<p>ISO15765-2 </p>
<p>performance </p>
<p>requirement </p>
<p>(see </p>
<p>3.9.2.2). </p>
<p>Calling </p>
<p>CanTp_StopSeparationTime()</p>
<p> afterwards has no effect. </p>
<p> </p>
<p>Figure 3-3 </p>
<p>Separation Time by Application </p>
<p>To activate the feature, the call-out function name must be specified in the config tool: </p>
<p> </p>
<p>CanTp/CanTpGeneral/CanTpApplSTminStartFunction </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>21 </p>
<p>based on template version 5.7.1 </p>
<p><b>3.1.2.12 </b></p>
<p><b>Mixed11 address extension forwarding </b></p>
<p>If  this  feature  is  enabled,  the  address  extension  (N_AE)  of  each  first  frame  and  single </p>
<p>frame received by the CanTp is forwarded to the Dcm. The forwarding is done using the </p>
<p>call-out function </p>
<p>Dcm_OnRequestDetection(PduIdType CanTpRxPduId, uint8 N_AE) </p>
<p>where </p>
<p>CanTpRxPduId</p>
<p>  is  the  Id  of  the  received  Rx  N-PDU  and </p>
<p>N_AE</p>
<p>  is  the  address </p>
<p>extension.  The  prototype  of  this  function  is  expected  to  be  provided  in  the  Dcm_Cbk.h </p>
<p>header file. </p>
<p>Configuration attribute: CanTpEnableDcmRequestDetect </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>The forwarding is done for all the first frames and single frames configured with </p>
<p>mixed11 addressing. Even the N_AE of frames discarded by the CanTp (because of an </p>
<p>unrecognized N_AE) will be forwarded. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>3.2 </b></p>
<p><b>Limitations </b></p>
<p><b>3.2.1 </b></p>
<p><b>Memory Optimization </b></p>
<p>Memory optimization by the linker via data scattering: </p>
<p>Some linkers allow filling the “holes”  caused by padding with some “foreign” data. Since </p>
<p>the  generation  tool  cannot  be  aware  of  “foreign”  data,  such  optimizations  must  be </p>
<p>disabled. </p>
<p> </p>
<p><b>3.2.2 </b></p>
<p><b>Channel Assignment </b></p>
<p>In the Vector CanTp, a channel always consists of at most one Rx N-SDU and one Tx N-</p>
<p>SDU.  Furthermore,  to  each  channel  at  most  one  Rx  N-PDU  and  one  Tx  N-PDU  is </p>
<p>assigned. These N-PDUs are shared between the two N-SDUs as shown in Figure 3-4. </p>
<p>As with CAN-FD an N-PDU can either be CAN2.0 or CAN-FD but not both, this implies </p>
<p>that  you  have  to  use  a  CAN-FD  Flow  Control  if  the  SFs  /  FFs  /  CFs  of  the  opposite </p>
<p>direction use CAN-FD. Otherwise you will need separate channels for the Rx and Tx N-</p>
<p>SDUs. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>22 </p>
<p>based on template version 5.7.1 </p>
<p> </p>
<p>Figure 3-4 </p>
<p>Channel Assignment for N-SDUs and N-PDUs </p>
<p>While each N-SDU represents a CanTp connection, the N-PDUs identify the CAN frames </p>
<p>that are transmitted and received via the CanIf.  </p>
<p>With  Standard  addressing,  each  N-PDU  can  only  be  assigned  to  one  channel.  With </p>
<p>extended and mixed11 addressing, an N-PDU may be used on multiple channels, but only </p>
<p>with different address information (N_TA / N_AE). </p>
<p><b>3.2.3 </b></p>
<p><b>Channel Addressing </b></p>
<p>Usage of different addressing within the same channel is not allowed. </p>
<p>The addressing format – CANTP_STANDARD, CANTP_EXTENDED or CANTP_MIXED11 </p>
<p>– must be identical for each pair of Rx/Tx N-SDUs assigned to the same channel. </p>
<p> </p>
<p><b>3.2.4 </b></p>
<p><b>Data Length Parameter </b></p>
<p>According  to  the  AUTOSAR  BSWMD  specification,  each  N-SDU  has  a  Data  Length </p>
<p>parameter (CanTpRxDl, CanTpTxDl). However, it is not clearly specified if this data length </p>
<p>applies  to  the  N-SDU (complete  message  length) or  to  the  N-PDU  (CAN message  data </p>
<p>length).  As  furthermore  the  parameters  are  anyway  deprecated  in  AR  4.1.1  (see  also </p>
<p>AUTOSAR RFC 53101), they are no longer evaluated by the CanTp.  </p>
<p>For compatibility reasons, the parameters are part of the ECUC file, but their values have </p>
<p>no effect. </p>
<p><b>3.3 </b></p>
<p><b>Initialization </b></p>
<p>The API  function </p>
<p>CanTp_Init()</p>
<p>  uses  the  given  configuration  set  to  initialize  all  global </p>
<p>variables of the CAN Transport Layer and brings it to the state Idle, where reception and </p>
<p>transmission tasks can be started. </p>
<p><b>3.4 </b></p>
<p><b>States </b></p>
<p>The CanTp module has two internal states, </p>
<p>CANTP_OFF </p>
<p>and </p>
<p>CANTP_ON</p>
<p>. After power up, </p>
<p>the  CanTp  is  in  the </p>
<p>CANTP_OFF </p>
<p>state.  In  this  state  no  communication  tasks  can  be </p>
<p>performed. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>23 </p>
<p>based on template version 5.7.1 </p>
<p>The  CanTp  changes  to  the  internal  state </p>
<p>CANTP_ON </p>
<p>when  it  has  been  successfully </p>
<p>initialized. Segmentation and reassembly tasks are only performed when the module is in </p>
<p>this  state.  After  initialization,  all  transport  protocol  connections  are  in  a  sub-state  of </p>
<p>CANTP_ON</p>
<p>, in which neither transmission nor reception is in progress (</p>
<p>CANTP_RX_IDLE </p>
<p>and </p>
<p>CANTP_TX_IDLE</p>
<p>). </p>
<p>If </p>
<p>called </p>
<p>when </p>
<p>the </p>
<p>CanTp </p>
<p>module </p>
<p>is </p>
<p>in </p>
<p>the </p>
<p>global </p>
<p>state </p>
<p>CANTP_ON, </p>
<p>the </p>
<p>function </p>
<p>CanTp_Init </p>
<p>returns the module to state Idle and all current connections are terminated</p>
<p>. </p>
<p>The  function </p>
<p>CanTp_Shutdown </p>
<p>stops  the  CanTp  module  properly  and  sets  the  global </p>
<p>state to CANTP_OFF. </p>
<p> </p>
<p>Figure 3-5 </p>
<p>CanTp internal states </p>
<p><b>3.5 </b></p>
<p><b>Main Functions </b></p>
<p>The  CanTp_MainFunction  controls  the  timing  behavior  of  the  CanTp  and  performs  all </p>
<p>tasks that have to be done cyclically. </p>
<p>Especially for the calculation of the different timings (delays, timeouts) it is important to call </p>
<p>the  main  function  periodically  with  the  time  interval  that  have  been  configured  with  the </p>
<p>‘CanTpMainFunctionPeriod’ parameter in the generation tool. </p>
<p>It  is  also  possible  to  separate  the  main  function  into  Rx  and  Tx,  e.g.  to  optimize  the </p>
<p>throughput (see chapter 3.1.2.1 for details). </p>
<p><b>stm CanTp</b></p>
<p><b>CANTP_ON</b></p>
<p>[Rx Connection Channel]</p>
<p>[Tx Connection Channel]</p>
<p><b>CANTP_TX_IDLE</b></p>
<p><b>CANTP_TX_PROCESSING</b></p>
<p><b>CANTP_RX_IDLE</b></p>
<p><b>CANTP_RX_PROCESSING</b></p>
<p><b>CANTP_OFF</b></p>
<p>Ini t</p>
<p>Ini t</p>
<p>PowerDown</p>
<p>CanTp_Init</p>
<p>CanTp_Shutdown</p>
<p>PowerUp</p>
<p>PowerDown</p>
<p>[Receive NPdu]</p>
<p>[Reception finished]</p>
<p>[Transmit NSdu]</p>
<p>[Transmission finished]</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>24 </p>
<p>based on template version 5.7.1 </p>
<p> </p>
<p><b>3.6 </b></p>
<p><b>Error Handling </b></p>
<p><b>3.6.1 </b></p>
<p><b>Development Error Reporting </b></p>
<p>By </p>
<p>default, </p>
<p>development </p>
<p>errors </p>
<p>are </p>
<p>reported </p>
<p>to </p>
<p>the </p>
<p>DET </p>
<p>using </p>
<p>the </p>
<p>service </p>
<p>Det_ReportError()</p>
<p>  as  specified  in  [5],  if development  error reporting  is  enabled  (i.e. </p>
<p>pre-compile parameter </p>
<p>CANTP_DEV_ERROR_DETECT==STD_ON</p>
<p>). </p>
<p>If  another  module  is  used  for  development  error  reporting,  the  function  prototype  for </p>
<p>reporting the error can be configured by the integrator, but must have the same signature </p>
<p>as the service </p>
<p>Det_ReportError()</p>
<p>. </p>
<p>The reported CanTp ID is 35. </p>
<p>The reported service IDs identifies the services which are described in 5.1. The following </p>
<p>table presents the service IDs and the related services. Services marked with an asterisk </p>
<p>(*) are internal service IDs: </p>
<p><b>Service ID </b></p>
<p><b>Service </b></p>
<p>0x01 </p>
<p>CanTp_Init </p>
<p>0x02 </p>
<p>CanTp_Shutdown </p>
<p>0x03 </p>
<p>CanTp_Transmit </p>
<p>0x04 </p>
<p>CanTp_RxIndication </p>
<p>0x05 </p>
<p>CanTp_TxConfirmation </p>
<p>0x06 </p>
<p>CanTp_MainFunction </p>
<p>0x07 </p>
<p>CanTp_GetVersionInfo </p>
<p>0x08 </p>
<p>CanTp_CancelTransmit </p>
<p>0x09 </p>
<p>CanTp_CancelReceive </p>
<p>0x0A </p>
<p>CanTp_ChangeParameter </p>
<p>0x0B </p>
<p>CanTp_ReadParameter </p>
<p>0x20* </p>
<p>CanTp_MainFunctionRx </p>
<p>0x21* </p>
<p>CanTp_MainFunctionTx </p>
<p>0x30* </p>
<p>CanTp_RxGetBuffer </p>
<p>0x31* </p>
<p>CanTp_TxGetBuffer </p>
<p>0x32* </p>
<p>CanTp_RxTransmitFrame </p>
<p>0x33* </p>
<p>CanTp_TxTransmitFrame </p>
<p>0x34* </p>
<p>CanTp_RxInit </p>
<p>0x35* </p>
<p>CanTp_TxInit </p>
<p>0x36* </p>
<p>CanTp_StopSeparationTimer </p>
<p>Table 3-5  </p>
<p>Service IDs </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>25 </p>
<p>based on template version 5.7.1 </p>
<p>The  errors  reported  to  DET  are  described  in  the  following  table.  Errors  marked  with  an </p>
<p>asterisk (*) are Vector specific: </p>
<p><b>Error Code </b></p>
<p><b>Description </b></p>
<p>0x01 </p>
<p>CANTP_E_PARAM_CONFIG  </p>
<p>API called with wrong parameters </p>
<p>0x02 </p>
<p>CANTP_E_PARAM_ID  </p>
<p>API called with wrong parameters </p>
<p>0x03 </p>
<p>CANTP_E_PARAM_POINTER </p>
<p>API called with wrong parameters </p>
<p>0x20 </p>
<p>CANTP_E_UNINIT </p>
<p>API service used without module initialization </p>
<p>0x30 </p>
<p>CANTP_E_INVALID_TX_ID  </p>
<p>Invalid Transmit N-PDU identifier </p>
<p>0x40 </p>
<p>CANTP_E_INVALID_RX_ID  </p>
<p>Invalid Receive N-PDU identifier </p>
<p>0x50 </p>
<p>CANTP_E_INVALID_TX_BUFFER  </p>
<p>Invalid Transmit buffer provided </p>
<p>0x60 </p>
<p>CANTP_E_INVALID_RX_BUFFER  </p>
<p>Invalid Receive buffer provided </p>
<p>0x70 </p>
<p>CANTP_E_INVALID_TX_LENGTH  </p>
<p>Invalid data length of the transmit N-PDU </p>
<p>0x80 </p>
<p>CANTP_E_INVALID_RX_LENGTH  </p>
<p>Invalid data length of the receive N-PDU </p>
<p>0x90 </p>
<p>CANTP_E_INVALID_TA_TYPE </p>
<p>Functional FF received, or transmission request for </p>
<p>a functional N-SDU with SF data length </p>
<p>0xA0 </p>
<p>CANTP_E_OPER_NOT_SUPPORTED </p>
<p>Requested operation is currently not available (e.g. </p>
<p>cancel a transmission that is not in progress) </p>
<p>0xB0 </p>
<p>CANTP_E_COM  </p>
<p>Implementation specific error </p>
<p>0xB1 </p>
<p>CANTP_E_INVALID_RX_STATE* </p>
<p>Rx state machine is in an invalid state </p>
<p>0xB2 </p>
<p>CANTP_E_INVALID_TX_STATE* </p>
<p>Tx state machine is in an invalid state </p>
<p>0xB3 </p>
<p>CANTP_E_INVALID_FRAME_TYPE* </p>
<p>An invalid frame type occurred </p>
<p>0xC0 </p>
<p>CANTP_E_RX_COM </p>
<p>General reception error </p>
<p>0xC1 </p>
<p>CANTP_E_RX_TIMEOUT_AR* </p>
<p>N_Ar timeout occurred </p>
<p>0xC2 </p>
<p>CANTP_E_RX_TIMEOUT_BR* </p>
<p>N_Br timeout occurred </p>
<p>0xC3 </p>
<p>CANTP_E_RX_TIMEOUT_CR* </p>
<p>N_Cr timeout occurred </p>
<p>0xC4 </p>
<p>CANTP_E_RX_INVALID_SN* </p>
<p>CF with invalid sequence number received </p>
<p>0xC5 </p>
<p>CANTP_E_RX_WFTMAX* </p>
<p>Max. number of wait frames transmitted </p>
<p>0xC6 </p>
<p>CANTP_E_RX_RESTART* </p>
<p>Connection terminate due to new SF/FF reception </p>
<p>0xC7 </p>
<p>CANTP_E_RX_TRANSMIT_ERROR* </p>
<p>Transmission of a flow control frame failed </p>
<p>0xD0 </p>
<p>CANTP_E_TX_COM </p>
<p>General transmission error </p>
<p>0xD1 </p>
<p>CANTP_E_TX_TIMEOUT_AS* </p>
<p>N_As timeout occurred </p>
<p>0xD2 </p>
<p>CANTP_E_TX_TIMEOUT_BS* </p>
<p>N_Bs timeout occurred </p>
<p>0xD3 </p>
<p>CANTP_E_TX_TIMEOUT_CS* </p>
<p>N_Cs timeout occurred </p>
<p>0xD4 </p>
<p>CANTP_E_TX_FC_OVFL* </p>
<p>FC.OVFL received </p>
<p>0xD5 </p>
<p>CANTP_E_TX_INVALID_FS* </p>
<p>FC with invalid flow status received </p>
<p>0xD6 </p>
<p>CANTP_E_TX_RES_STMIN* </p>
<p>FC with reserved STmin received, but not allowed </p>
<p>0xD7 </p>
<p>CANTP_E_TX_TRANSMIT_ERROR* </p>
<p>Transmission of a frame failed </p>
<p>Table 3-6  </p>
<p>Errors reported to DET </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>26 </p>
<p>based on template version 5.7.1 </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>FAQ: How to avoid DET errors for failed CanTp communication? </b></p>
<p>AUTOSAR specifies that the CanTp shall not only report a DET for typical integration </p>
<p>errors, but also for communication errors like timeouts. Although sometimes helpful, in </p>
<p>most cases this is not desired. </p>
<p>To suppress reporting a DET error for all erroneously terminated connections, filters </p>
<p>with the following parameters have to be configured in the DET module: </p>
<p><b>&gt; </b></p>
<p>moduleId   = 0x23 </p>
<p><b>&gt; </b></p>
<p>instanceId  = 0x00   </p>
<p><b>&gt; </b></p>
<p>apiId  </p>
<p> </p>
<p> </p>
<p>= 0x34 and 0x35 </p>
<p><b>&gt; </b></p>
<p>errorId  </p>
<p> </p>
<p>= 0xFF  </p>
<p>Please note that the filtering mechanism is a Vector specific feature, which is described </p>
<p>in more detail in the Vector DET Technical Reference. </p>
<p>When using other DET implementations, these errors can be filtered in a DET callout </p>
<p>which abandons further DET processing and continues the CanTp code. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<p><b> </b></p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>27 </p>
<p>based on template version 5.7.1 </p>
<p><b>3.6.1.1 </b></p>
<p><b>Parameter Checking </b></p>
<p>AUTOSAR requires that API functions check the validity of their parameters. The checks in </p>
<p>Table  3-7  are  internal  parameter  checks  of  the  API  functions.  These  checks  are  for </p>
<p>development  error  reporting  and  can  be  en-/disabled  via  the  configuration  parameter </p>
<p>CanTp_DEV_ERROR_DETECT</p>
<p>. </p>
<p>The following  table  shows  the  parameter checks  performed  by  the  CanTp  services.  For </p>
<p>parameter checks marked with an asterisk (*), only the error reporting can be deactivated. </p>
<p>The check will also be performed if development error reporting is disabled. </p>
<p><b>Check </b></p>
<p> </p>
<p> </p>
<p> </p>
<p><b>Service </b></p>
<p>CanTpRxSduId </p>
<p>CanTpTxSduId </p>
<p>CanTpRxPduId </p>
<p>CanIfTxPduId </p>
<p>pCanTpRxPduPtr </p>
<p>pData </p>
<p>Pid </p>
<p>Pval </p>
<p>pVersionInfo </p>
<p>CanTp_RxIndication </p>
<p> </p>
<p> </p>
<p></p>
<p> </p>
<p> </p>
<p></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>CanTp_CancelReceive </p>
<p></p>
<p>* </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>CanTp_ChangeParameter </p>
<p></p>
<p>* </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p></p>
<p>* </p>
<p></p>
<p>* </p>
<p> </p>
<p>CanTp_ReadParameter </p>
<p></p>
<p>* </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p></p>
<p>* </p>
<p></p>
<p>* </p>
<p> </p>
<p>CanTp_Transmit </p>
<p> </p>
<p></p>
<p>* </p>
<p> </p>
<p> </p>
<p> </p>
<p></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>CanTp_CancelTransmit </p>
<p> </p>
<p></p>
<p>* </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>CanTp_TxConfirmation </p>
<p> </p>
<p> </p>
<p> </p>
<p></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>CanTp_GetVersionInfo </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p></p>
<p> </p>
<p>CanTp_StopSeparationTime </p>
<p> </p>
<p></p>
<p>* </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Table 3-7  </p>
<p>Development Error Reporting: Assignment of checks to services </p>
<p> </p>
<p><b>3.6.2 </b></p>
<p><b>Production Code Error Reporting </b></p>
<p>In AR4, the CanTp reports no production errors to the Diagnostic Event Manager. </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>28 </p>
<p>based on template version 5.7.1 </p>
<p><b>3.7 </b></p>
<p><b>Channel Mode </b></p>
<p>In the configuration tool, two connections can be grouped to one logical channel (see also </p>
<p>3.2.2).  </p>
<p>For each of these logical channels it can be configured if the channel is half or full duplex. </p>
<p><b>&gt; </b></p>
<p>Half Duplex: only the Rx or the Tx N-SDU of a channel can be active at a time. A </p>
<p>connection which is started while the opposite direction is being processed will be </p>
<p>rejected. </p>
<p><b>&gt; </b></p>
<p>Full Duplex:  bidirectional communication is possible at any time. </p>
<p>When only one N-SDU is configured for a channel, the channel mode parameter has no </p>
<p>effect. </p>
<p> </p>
<p><b>3.8 </b></p>
<p><b>Connection Channels </b></p>
<p>A connection channel represents an internal path for transmission or reception of  an N-</p>
<p>SDU  during  runtime.  It  uses  its  own  resources  such  as  internal  buffer,  timer  or  state </p>
<p>machine.  Therefore, </p>
<p>each </p>
<p>connection </p>
<p>channel </p>
<p>is </p>
<p>independent </p>
<p>from </p>
<p>the </p>
<p>others.  The </p>
<p>connection channels are only for CanTp internal use and not accessible externally.  </p>
<p>By default, each N-SDU is statically linked to one connection channel (exception: dynamic </p>
<p>channel assignment is used; see 3.1.2.5). </p>
<p> </p>
<p>The  CanTp  is  able  to  manage  several  connections for different N-SDUs  simultaneously. </p>
<p>However it is not possible to handle two receptions or two transmissions with the same N-</p>
<p>SDU identifier in parallel. </p>
<p>If a new FF / SF is received for an already active N-SDU, the connection is terminated and </p>
<p>restarted. </p>
<p>If a new transmission request is started for an already active N-SDU, the request is </p>
<p>rejected. If it is required to start a new transmission before the previous one is finished, the </p>
<p>active connection must first be terminated by using the transmit cancellation function (see </p>
<p>5.1.10 CanTp_CancelTransmit()). </p>
<p> </p>
<p><b> </b></p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>29 </p>
<p>based on template version 5.7.1 </p>
<p><b>3.9 </b></p>
<p><b>Connection Timings </b></p>
<p><b>3.9.1 </b></p>
<p><b>Timing Parameters </b></p>
<p>The ISO specifies several protocol timing parameters for receiver and transmitter side. The </p>
<p>following figure shall give an overview which timeouts exist and when they are applied. </p>
<p> </p>
<p>Figure 3-6 </p>
<p>Connection Timing </p>
<p><b>Timeout </b></p>
<p><b>Description </b></p>
<p>Transmission </p>
<p>N_As </p>
<p>Timeout when waiting for the TxConfirmation of a transmitted SF, FF, or CF </p>
<p>N_Bs </p>
<p>Timeout when waiting for a Flow Control </p>
<p>N_Cs </p>
<p>Time until next CF has to be transmitted, or timeout when waiting a buffer </p>
<p>Reception </p>
<p>N_Ar </p>
<p>Timeout when waiting for the TxConfirmation of a transmitted FC </p>
<p>N_Br </p>
<p>Time before the transmission of the next FC (see 3.9.2.3)  </p>
<p>or Timeout when waiting after SF reception for a buffer </p>
<p>N_Cr </p>
<p>Timeout when waiting for next CF </p>
<p>Table 3-8  </p>
<p>Connection Timing Parameters </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>30 </p>
<p>based on template version 5.7.1 </p>
<p><b>3.9.2 </b></p>
<p><b>Timing Considerations and Jitter </b></p>
<p><b>3.9.2.1 </b></p>
<p><b>Jitter </b></p>
<p>The  time  base  for  all  timeout  parameters  is  the  main  function  period  of  the  CanTp. </p>
<p>Because the starting point of each timeout may be located sometime between two main </p>
<p>function calls, a jitter of up to one task cycle can occur and must be taken into account. </p>
<p>The CanTp tries to compensate this by adding one task cycle to the configured timings, so </p>
<p>the observed timings can be longer, but will never be shorter than configured.  </p>
<p> </p>
<p><b>3.9.2.2 </b></p>
<p><b>Separation Time </b></p>
<p>ISO  15765-2  specifies  two  timing  parameters  which  determine  the  time  between  the </p>
<p>transmissions of two consecutive frames.  </p>
<p><b>STmin </b>is the minimum separation time, which is provided by the receiver. If the transmitter </p>
<p>sends  the  CFs  faster  than  requested,  there  is  no  guarantee  that  the  receiver  of  the </p>
<p>segmented  data  transmission  will  correctly  receive  and  process  all  frames.  Another </p>
<p>purpose of STmin is to reduce the bus load produced by CanTp communication. </p>
<p><b>N_Cs </b>is the maximum separation time, after which the transmission of the next CF has to </p>
<p>be started. If the delay is longer than N_Cs, the receiver side may detect an N_Cr timeout. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>In case of a conflict between the configured N_Cs and the requested STmin (N_Cs &lt; </p>
<p>STmin), the CanTp will transmit the next CF after the end of N_Cs and therefore violate </p>
<p>STmin. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p>Basically, for STmin the same provisions regarding jitter are made as for all other timings </p>
<p>(see 3.9.2.1). However, some STmin specific characteristics apply here: </p>
<p><b>&gt; </b></p>
<p>in burst mode (STmin = 0) the CFs are sent as fast as possible, i.e. from the context of </p>
<p>the TxConfirmaton of the previous CF. The observed separation time then only </p>
<p>depends on the bus load. </p>
<p><b>&gt; </b></p>
<p>when a microsecond STmin is requested (0xF1…0xF9) the CF is always sent on the </p>
<p>next task. No additional task cycle is added. Therefore if the bus load is very high and </p>
<p>the TxConfirmation is delayed too long, the observed separation time might </p>
<p>sporadically be above the given value. </p>
<p><b>&gt; </b></p>
<p>when STmin supervision is done not internally but by the application (see 3.1.2.11), </p>
<p>the CanTp only transmits the CF by itself in case N_Cs expires. </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>31 </p>
<p>based on template version 5.7.1 </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>FAQ: Why is the observed STmin so much longer than the requested STmin? </b></p>
<p>Because of the jitter, the CanTp always adds one task cycle to the requested STmin in </p>
<p>order to guarantee that the time between two CFs is never below STmin. When the </p>
<p>task cycle time is higher than STmin, this may lead to unexpected high separation </p>
<p>times (see Table 3-9). </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Requested STmin </b></p>
<p><b>Observed ST (5ms cyle time) </b></p>
<p><b>Observed ST (10ms cyle time) </b></p>
<p>0ms (burst) </p>
<p>as fast as possible  </p>
<p>as fast as possible </p>
<p>100µs </p>
<p>&lt; 5ms </p>
<p>&lt; 10ms </p>
<p>1ms </p>
<p>5…10ms </p>
<p>10…20ms </p>
<p>5ms </p>
<p>5…10ms </p>
<p>10…20ms </p>
<p>6ms </p>
<p>10…15ms </p>
<p>10…20ms </p>
<p>10ms </p>
<p>10…15ms </p>
<p>10…20ms </p>
<p>11ms </p>
<p>15…20ms </p>
<p>20…30ms </p>
<p>Table 3-9  </p>
<p>Examples for requested and observed separation times </p>
<p><b>3.9.2.3 </b></p>
<p><b>Implementation of N_Br </b></p>
<p>The ISO 157675-2 defines the parameter N_Br as follows:  </p>
<p><i>N_Br: Time until transmission of the next Flow Control N_PDU </i></p>
<p>Since N_Br is only a performance parameter and no timeout that must be applied in case </p>
<p>of erroneous behavior, it can be seen as the maximum time after which a Flow Control has </p>
<p>to be transmitted.  Considering  this,  the following  behavior  has been  implemented  in the </p>
<p>CanTp: </p>
<p><b>&gt; </b></p>
<p>After the reception of a First Frame, the first Flow Control is transmitted immediately </p>
<p>(N_Br = 0ms). </p>
<p><b>&gt; </b></p>
<p>After the reception of the last Consecutive Frame in a block, the next Flow Control is </p>
<p>transmitted immediately (N_Br = 0ms). </p>
<p><b>&gt; </b></p>
<p>After FC.WAIT, the subsequent FC.CTS is transmitted as soon as sufficient buffer is </p>
<p>provided. If no buffer is provided, the next FC.WAIT is transmitted after N_Br. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>The flow status (CTS, WAIT, OVFL) depends on the result of the buffer provision.  </p>
<p>FC.WAIT is sent if the buffer is temporarily unavailable or too small. In this case the </p>
<p>receiver will continue to send FC.WAIT until the buffer status changes or the maximum </p>
<p>number of wait frames (configuration parameter WFTmax) is reached. </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>32 </p>
<p>based on template version 5.7.1 </p>
<p><b>4 </b></p>
<p><b>Integration </b></p>
<p>This chapter gives necessary information for the integration of the MICROSAR CanTp into </p>
<p>an application environment of an ECU. </p>
<p><b>4.1 </b></p>
<p><b>Scope of Delivery </b></p>
<p>The delivery of the CanTp contains the files which are described in the chapters 4.1.1 and </p>
<p>4.1.2: </p>
<p><b>4.1.1 </b></p>
<p><b>Static Files </b></p>
<p><b>File Name </b></p>
<p><b>Source </b></p>
<p><b>Code </b></p>
<p><b>Delivery </b></p>
<p><b>Object </b></p>
<p><b>Code </b></p>
<p><b>Delivery </b></p>
<p><b>Description </b></p>
<p>CanTp.c </p>
<p></p>
<p> </p>
<p> </p>
<p>Source file of the CanTp </p>
<p>CanTp.h </p>
<p></p>
<p> </p>
<p> </p>
<p>Header file of the CanTp </p>
<p>CanTp_Cbk.h </p>
<p></p>
<p> </p>
<p> </p>
<p>Header file with CanTp callback function prototypes </p>
<p>CanTp_Types.h </p>
<p></p>
<p> </p>
<p> </p>
<p>Header file with global CanTp type definitions. </p>
<p>CanTp_Priv.h </p>
<p></p>
<p> </p>
<p> </p>
<p>Header file with internal CanTp definitions. </p>
<p>CanTp.lib </p>
<p> </p>
<p></p>
<p> </p>
<p>Library of the CanTp</p>
<p> </p>
<p>Table 4-1  </p>
<p>Static files </p>
<p> </p>
<p> </p>
<p><b>4.1.2 </b></p>
<p><b>Dynamic Files </b></p>
<p>The dynamic files are generated by the configuration. </p>
<p><b>File Name </b></p>
<p><b>Description </b></p>
<p>CanTp_Cfg.h </p>
<p>This is the generated header file of CanTp containing pre-compile switches </p>
<p>and providing symbolic defines. </p>
<p>CanTp_Cfg.c </p>
<p>This is the generated source file of CanTp containing pre-compile-time </p>
<p>configurable parameters </p>
<p>CanTp_Lcfg.h </p>
<p>This is the generated header file of CanTp containing link-time configurable </p>
<p>symbols </p>
<p>CanTp_Lcfg.c </p>
<p>This is the generated source file of CanTp containing link-time configurable </p>
<p>parameters </p>
<p>CanTp_PBcfg.c </p>
<p>This is the generated source file of CanTp containing post-build-time </p>
<p>configurable parameters </p>
<p>CanTp_PBcfg.c </p>
<p>This is the generated source file of CanTp containing post-build-time </p>
<p>configurable parameters </p>
<p>Table 4-2  </p>
<p>Generated files </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>33 </p>
<p>based on template version 5.7.1 </p>
<p><b>4.2 </b></p>
<p><b>Include Structure </b></p>
<p>  </p>
<p>Figure 4-1 </p>
<p>Include structure </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>The only files that need to be included by other modules and software components are </p>
<p>CanTp.h</p>
<p> and </p>
<p>CanTp_Cbk.h</p>
<p>. These files contain all definitions and inclusions required </p>
<p>to use the CanTp. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b> </b></p>
<p>CANTP</p>
<p>CanTp.c</p>
<p>CanTp.h</p>
<p>CanTp_Cfg.h</p>
<p>CanTp_Cbk.h</p>
<p>CanTp_Types.h</p>
<p>SchM_CanTp.h</p>
<p>MemMap.h</p>
<p>ComStackTypes.h</p>
<p>PduR_CanTp.h</p>
<p>CanIf.h</p>
<p>Det.h</p>
<p>CanTp_Lcfg.h</p>
<p>CanTp_PBcfg.h</p>
<p>CanTp_Priv.h</p>
<p>CanTp_PBcfg.c</p>
<p>CanTp_Cfg.c</p>
<p>CanTp_Lcfg.c</p>
<p>EcuM_Error.h</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>34 </p>
<p>based on template version 5.7.1 </p>
<p><b>4.3 </b></p>
<p><b>Compiler Abstraction and Memory Mapping  </b></p>
<p>The  objects  (e.g.  variables,  functions,  constants)  are  declared  by  compiler  independent </p>
<p>definitions  –  the  compiler  abstraction  definitions.  Each  compiler  abstraction  definition  is </p>
<p>assigned to a memory section. </p>
<p>The  following  table  contains  the  memory  section  names  and  the  compiler  abstraction </p>
<p>definitions of the CanTp and illustrates their assignment among each other. </p>
<p><b>Compiler Abstraction </b></p>
<p><b>Definitions </b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<p><b>Memory Mapping </b></p>
<p><b>Sections </b></p>
<p>CANTP_CODE </p>
<p>CANTP_APPL_DATA </p>
<p>CANTP_VAR_NOINIT </p>
<p>CANTP_VAR_INIT </p>
<p>CANTP_PBCFG </p>
<p>CANTP_VAR_PBCFG </p>
<p>CANTP_CONST </p>
<p>CANTP_START_SEC_CODE </p>
<p>CANTP_STOP_SEC_CODE </p>
<p></p>
<p> </p>
<p></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>CANTP_START_SEC_VAR_NOINIT_8BIT </p>
<p>CANTP_START_SEC_VAR_NOINIT_8BIT </p>
<p> </p>
<p> </p>
<p></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>CANTP_START_SEC_VAR_INIT_UNSPECIFIED </p>
<p>CANTP_STOP_SEC_VAR_INIT_UNSPECIFIED </p>
<p> </p>
<p> </p>
<p> </p>
<p></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>CANTP_START_SEC_PBCFG  </p>
<p>CANTP_STOP_SEC_PBCFG </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p></p>
<p> </p>
<p> </p>
<p> </p>
<p>CANTP_START_SEC_VAR_PBCFG  </p>
<p>CANTP_STOP_SEC_VAR_PBCFG </p>
<p> </p>
<p></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p></p>
<p> </p>
<p> </p>
<p>CANTP_START_SEC_CONST_16BIT </p>
<p>CANTP_STOP_SEC_CONST_16BIT </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p></p>
<p> </p>
<p>Table 4-3  </p>
<p>Compiler abstraction and memory mapping </p>
<p><b>4.3.1 </b></p>
<p><b>Memory mapping rules </b></p>
<p>Due  to  reuse  of  existing  code,  some  pointers  in  the  CanTp  may  point  to  variables  of </p>
<p>different  memory  classes.  Therefore  it  must  be  ensured  that  the  following  compiler </p>
<p>abstraction definitions are mapped to compatible memory sections: </p>
<p><b>&gt; </b></p>
<p>CANTP_VAR_PBCFG and CANTP_APPL_DATA </p>
<p><b>&gt; </b></p>
<p>CANTP_VAR_PBCFG and PDUR_APPL_DATA </p>
<p> </p>
<p> </p>
<p><b> </b></p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>35 </p>
<p>based on template version 5.7.1 </p>
<p><b>4.4 </b></p>
<p><b>Critical Sections </b></p>
<p>The synchronization mechanism defined by AUTOSAR covers the entering and leaving of </p>
<p>so called critical sections. Different critical sections can be handled by using different so </p>
<p>called “Exclusive Areas”. </p>
<p>CanTp supports only one exclusive area (CANTP_EXCLUSIVE_AREA_0), which can be </p>
<p>entered from task and interrupt level. It protects all internal state data against unintended </p>
<p>modification due to concurrent access and is entered from the following APIs: </p>
<p><b>&gt; </b></p>
<p>CanTp_RxIndication </p>
<p><b>&gt; </b></p>
<p>CanTp_TxConfirmation </p>
<p><b>&gt; </b></p>
<p>CanTp_Transmit </p>
<p><b>&gt; </b></p>
<p>CanTp_ChangeParameter </p>
<p><b>&gt; </b></p>
<p>CanTp_CancelReceive </p>
<p><b>&gt; </b></p>
<p>CanTp_CancelTransmit </p>
<p><b>&gt; </b></p>
<p>CanTp_StopSeparationTime </p>
<p><b>&gt; </b></p>
<p>CanTp_MainFunction </p>
<p>The exclusive area must lock the interrupts from all bus systems which may affect CanTp </p>
<p>operation. So while in CAN-only systems, locking the CAN interrupts is sufficent, e.g. in an </p>
<p>ECU which does CAN-FlexRay routing, also the FlexRay interrupts have to be locked. </p>
<p> </p>
<p><b>4.5 </b></p>
<p><b>Buffer Configuration </b></p>
<p>The  CanTp  is  able  to  work  with  segmented  reception  buffers,  i.e. </p>
<p>usually  it  is  not </p>
<p>necessary to provide a buffer with size of the complete message to be received. </p>
<p>Basically it is sufficient to provide a buffer which is large enough to store the payload of all </p>
<p>CFs within a block. The CanTp will adjust the block size and flow status parameters in the </p>
<p>FC frames according to the currently available buffer to control the reception data flow. A </p>
<p>new buffer is requested before the start of a new block, i.e. when an FC.CTS is sent. </p>
<p>However, some configuration options limit the reception control capabilities of the CanTp. </p>
<p>This must be taken into account during configuration of the buffer size in an upper layer </p>
<p>module (e.g. in the PduR when using high level routing). </p>
<p> </p>
<p><b>4.5.1 </b></p>
<p><b>Constant Block Size </b></p>
<p>If the CanTp is not allowed to change the block size during reception (see also  3.1.2.4), </p>
<p>the buffer size which is reported to the CanTp upon request at the end of a block should </p>
<p>also  not  change  after  the  first  FC.CTS  has  been  transmitted.  Otherwise  the  CanTp  will </p>
<p>transmit an FC.WAIT until enough buffer is available, which  will unnecessarily delay the </p>
<p>reception. </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>36 </p>
<p>based on template version 5.7.1 </p>
<p><b>4.5.2 </b></p>
<p><b>Zero Block Size </b></p>
<p>If the Block Size is configured as zero, an FC is only allowed after FF reception. If once a </p>
<p>FC.CTS  is  transmitted,  the  CanTp  has  no  possibility  to  delay  the  reception  if  the  upper </p>
<p>layer  runs  out  of  buffer.  The  CanTp  will  try  to  get  more  buffer  between  two  CFs  while </p>
<p>waiting for STmin, but for better robustness it is recommended to use BS = 0 only if a full </p>
<p>buffer is available. Otherwise the connection will be terminated with an error if the CanTp </p>
<p>is still waiting for a buffer when the next CF is received. </p>
<p> </p>
<p><b>4.5.3 </b></p>
<p><b>Zero WFTmax  </b></p>
<p>A WFTmax value of zero does suppress the transmission of FC.WAIT, i.e. the CanTp is not </p>
<p>allowed  to  delay  reception.  If  nevertheless  a  situation  occurs  where  an  FC.WAIT  is </p>
<p>needed,  the  connection  will  be  terminated.  Therefore,  similar  to  the  case  with  constant </p>
<p>block  size,  it  is  important  to  provide  always  enough  buffer for one  complete  block  or  (if </p>
<p>block size is not constant) for at least one CF. </p>
<p> </p>
<p><b>4.5.4 </b></p>
<p><b>Zero STmin </b></p>
<p>With  a  STmin  of  zero,  each  CF  is  transmitted  immediately  after  the  previous  CF.  This </p>
<p>eliminates the possibility of a buffer request between two CFs in case of BS = 0. If such a </p>
<p>situation nevertheless occurs, the connection will be erroneously terminated on reception </p>
<p>of the next CF. </p>
<p>Therefore it is highly recommended to provide always a full buffer when BS = 0 and STmin </p>
<p>= 0 are used. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>37 </p>
<p>based on template version 5.7.1 </p>
<p><b>5 </b></p>
<p><b>API Description </b></p>
<p>For an interfaces overview please see Figure 2-2. </p>
<p> </p>
<p><b>5.1 </b></p>
<p><b>Services provided by CanTp </b></p>
<p><b>5.1.1 </b></p>
<p><b>CanTp_InitMemory </b></p>
<p><b>Prototype </b></p>
<p>void</p>
<p> </p>
<p><b>CanTp_InitMemory</b></p>
<p> </p>
<p>( void )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>N/A </p>
<p>N/A </p>
<p><b>Return code </b></p>
<p>Void </p>
<p>N/A </p>
<p><b>Functional Description </b></p>
<p>Service to initialize module global variables at power up. This function initializes the variables in *_INIT_* </p>
<p>sections and should be used in case they are not initialized by the startup code. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function must be called prior to CanTp_Init </p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p><b>&gt; </b></p>
<p>This function is non-reentrant.</p>
<p> </p>
<p><b>&gt; </b></p>
<p>This function is synchronous.</p>
<p> </p>
<p>Table 5-1  </p>
<p>CanTp_InitMemory </p>
<p> </p>
<p><b> </b></p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>38 </p>
<p>based on template version 5.7.1 </p>
<p><b>5.1.2 </b></p>
<p><b>CanTp_Init() </b></p>
<p><b>Prototype </b></p>
<p>void</p>
<p> </p>
<p><b>CanTp_Init</b></p>
<p> </p>
<p>( const CanTp_ConfigType*  CfgPtr )</p>
<p> </p>
<p><b>Parameter </b></p>
<p> CfgPtr </p>
<p>Pointer to the CanTp post-build configuration data. </p>
<p>In configurations supporting multiple variants or post-build, a </p>
<p>#define</p>
<p> with a </p>
<p>config pointer for each available configuration set is generated. </p>
<p>In simple precompile configurations, the parameter is not used by the CanTp </p>
<p>and can be set to NULL. </p>
<p><b>Return code </b></p>
<p>Void </p>
<p>N/A </p>
<p><b>Functional Description </b></p>
<p>This function initializes the CanTp module. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p><b>&gt; </b></p>
<p>This function is non-reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous.</p>
<p> </p>
<p>Table 5-2  </p>
<p>CanTp_Init() </p>
<p> </p>
<p><b>5.1.3 </b></p>
<p><b>CanTp_Shutdown() </b></p>
<p><b>Prototype </b></p>
<p>void</p>
<p> </p>
<p><b>CanTp_Shutdown</b></p>
<p> </p>
<p>( void )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>N/A </p>
<p>N/A </p>
<p><b>Return code </b></p>
<p>Void </p>
<p>N/A </p>
<p><b>Functional Description </b></p>
<p>This function is called to shut down the CanTp module. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p><b>&gt; </b></p>
<p>This function is non-reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous.</p>
<p> </p>
<p>Table 5-3  </p>
<p>CanTp_Shutdown() </p>
<p> </p>
<p><b> </b></p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>39 </p>
<p>based on template version 5.7.1 </p>
<p><b>5.1.4 </b></p>
<p><b>CanTp_MainFunction() </b></p>
<p><b>Prototype </b></p>
<p>void</p>
<p> </p>
<p><b>CanTp_MainFunction</b></p>
<p> </p>
<p>( void )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>N/A </p>
<p>N/A </p>
<p><b>Return code </b></p>
<p>void </p>
<p>N/A </p>
<p><b>Functional Description </b></p>
<p>The main function for scheduling the CanTp. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p><b>&gt; </b></p>
<p>This function is non-reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous.</p>
<p> </p>
<p>Table 5-4  </p>
<p>CanTp_MainFunction() </p>
<p> </p>
<p><b>5.1.5 </b></p>
<p><b>CanTp_MainFunctionRx() </b></p>
<p><b>Prototype </b></p>
<p>void</p>
<p> </p>
<p><b>CanTp_MainFunctionRx</b></p>
<p> </p>
<p>( void )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>N/A </p>
<p>N/A </p>
<p><b>Return code </b></p>
<p>void </p>
<p>N/A </p>
<p><b>Functional Description </b></p>
<p>The main function for scheduling the receive channels of the CanTp. This function is only available if the </p>
<p>split MainFunction feature is activated </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p><b>&gt; </b></p>
<p>This function is non-reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>This API is optional and can be deactivated (see 3.1.2.1) </p>
<p>Compiler switch: CANTP_RXTX_MAINFUNCTION_API </p>
<p>Configuration attribute: CanTpEnableSplitMainFunction</p>
<p> </p>
<p>Table 5-5  </p>
<p>CanTp_MainFunctionRx() </p>
<p> </p>
<p><b> </b></p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>40 </p>
<p>based on template version 5.7.1 </p>
<p><b>5.1.6 </b></p>
<p><b>CanTp_MainFunctionTx() </b></p>
<p><b>Prototype </b></p>
<p>void</p>
<p> </p>
<p><b>CanTp_MainFunctionTx</b></p>
<p> </p>
<p>( void )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>N/A </p>
<p>N/A </p>
<p><b>Return code </b></p>
<p>void </p>
<p>N/A </p>
<p><b>Functional Description </b></p>
<p>The main function for scheduling the transmit channels of the CanTp. This function is only available if the </p>
<p>split MainFunction feature is activated </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p><b>&gt; </b></p>
<p>This function is non-reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>This API is optional and can be deactivated (see 3.1.2.1) </p>
<p>Compiler switch: CANTP_RXTX_MAINFUNCTION_API </p>
<p>Configuration attribute: CanTpEnableSplitMainFunction</p>
<p> </p>
<p>Table 5-6  </p>
<p>CanTp_MainFunctionTx() </p>
<p> </p>
<p><b>5.1.7 </b></p>
<p><b>CanTp_GetVersionInfo() </b></p>
<p><b>Prototype </b></p>
<p>void</p>
<p> </p>
<p><b>CanTp_GetVersionInfo</b></p>
<p> </p>
<p>( Std_VersionInfoType* versioninfo )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>versioninfo </p>
<p>reference to a variable where to store the version information of the CanTp </p>
<p><b>Return code </b></p>
<p>void </p>
<p>N/A </p>
<p><b>Functional Description </b></p>
<p>This function returns the version information of the CanTp module. </p>
<p>The version information includes: Module Id, Vendor Id and Vendor specific version numbers.   </p>
<p>The version numbers are BCD-coded. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p><b>&gt; </b></p>
<p>This function is reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>This API is optional and can be deactivated </p>
<p>Compiler switch: CANTP_VERSION_INFO_API </p>
<p>Configuration attribute: CanTpVersionInfoApi</p>
<p> </p>
<p>Table 5-7  </p>
<p>CanTp_GetVersionInfo() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>41 </p>
<p>based on template version 5.7.1 </p>
<p><b>5.1.8 </b></p>
<p><b>CanTp_Transmit() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>CanTp_Transmit</b></p>
<p> </p>
<p>( PduIdType CanTpTxSduId, const PduInfoType* </p>
<p>CanTpTxInfoPtr )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>CanTpTxSduId </p>
<p>Unique CanTp identifier of the N-SDU to be transmitted. </p>
<p>Range: 0..(maximum number of Tx N-SDU IDs ) - 1 </p>
<p>CanTpTxInfoPtr </p>
<p>This reference to a PduInfoType structure contains the length to be </p>
<p>transmitted (SduLength) and a data pointer (SduDataPointer). Only the </p>
<p>SduLength is used by CanTp_Transmit. The data to be transmitted is </p>
<p>requested separately by the CanTp. Thereto the function </p>
<p>PduR_CanTpCopyTxData is used. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: The transmit request has been started successfully </p>
<p>E_NOT_OK: The request cannot be started (e.g. a transmit request is in </p>
<p>progress with the same N-SDU identifier) </p>
<p> </p>
<p><b>Functional Description </b></p>
<p>This service is used to request the transfer of segmented data. </p>
<p> </p>
<p>If data length is less than 7 or 6, depending on the addressing format (standard, extended. mixed11), a SF </p>
<p>N-PDU is sent. Otherwise, if data length is greater than 7 or 6, a multiple frame transmission session is </p>
<p>initiated.  </p>
<p>When the transmit request has been completed, the CanTp notifies the upper layer by calling the </p>
<p>PduR_CanTpTxConfirmation callback function.   </p>
<p>Also, if an error occurred (overflow, timeout etc.), the transmit request is aborted and the </p>
<p>PduR_CanTpTxConfirmation callback is called with the appropriate error result value.  </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p><b>&gt; </b></p>
<p>This function is reentrant. </p>
<p><b>&gt; </b></p>
<p>This function can be configured to be synchronous or asynchronous (see 0).</p>
<p> </p>
<p>Table 5-8  </p>
<p>CanTp_Transmit() </p>
<p> </p>
<p><b> </b></p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>42 </p>
<p>based on template version 5.7.1 </p>
<p><b>5.1.9 </b></p>
<p><b>CanTp_CancelReceive() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>CanTp_CancelReceive</b></p>
<p> </p>
<p>( PduIdType CanTpRxSduId )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>CanTpRxSduId </p>
<p>Identifier of the Rx N-SDU, for which a reception shall be cancelled. </p>
<p>Range: 0..(maximum number of Rx N-SDU IDs) - 1 </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: Cancellation request of the specified N-SDU is accepted. </p>
<p>E_NOT_OK: Cancellation request is rejected; the reason can be that the </p>
<p>request is issued for an N-SDU that is not segmented or that is not in the </p>
<p>reception process. </p>
<p><b>Functional Description </b></p>
<p>This service is used to cancel the ongoing reception of an N-SDU. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p><b>&gt; </b></p>
<p>This function is non-reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>This API is optional and can be deactivated </p>
<p>Compiler switch: CANTP_RC </p>
<p>Configuration attribute: CanTpRc</p>
<p> </p>
<p>Table 5-9  </p>
<p>CanTp_CancelReceive() </p>
<p> </p>
<p><b> </b></p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>43 </p>
<p>based on template version 5.7.1 </p>
<p><b>5.1.10 </b></p>
<p><b>CanTp_CancelTransmit() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>CanTp_CancelTransmit</b></p>
<p> </p>
<p>( PduIdType CanTpTxSduId )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>CanTpTxSduId </p>
<p>Identifier of the Tx N-SDU, for which a transmission shall be cancelled. </p>
<p>Range: 0..(maximum number of Tx N-SDU IDs) - 1 </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: Cancellation request of the specified N-SDU is accepted. </p>
<p>E_NOT_OK: Cancellation request is rejected; the reason can be that request </p>
<p>is issued for an N-SDU that is not segmented, request is issued after the last </p>
<p>CF has been requested for transmission or cancellation is not possible for the </p>
<p>related N-SDU due to configuration. </p>
<p><b>Functional Description </b></p>
<p>This service is used to cancel the ongoing transmission of an N-SDU. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p><b>&gt; </b></p>
<p>This function is non-reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>This API is optional and can be deactivated </p>
<p>Compiler switch: CANTP_TC </p>
<p>Configuration attribute: CanTpTc</p>
<p> </p>
<p>Table 5-10  </p>
<p>CanTp_CancelTransmit() </p>
<p> </p>
<p><b> </b></p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>44 </p>
<p>based on template version 5.7.1 </p>
<p><b>5.1.11 </b></p>
<p><b>CanTp_ChangeParameter() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>CanTp_ChangeParameter</b></p>
<p> </p>
<p>( PduIdType id, TPParameterType parameter, </p>
<p>uint16 value )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>id </p>
<p>Identifier of the Rx N-SDU, for which a parameter shall be changed. </p>
<p>Range: 0..(maximum number of Rx N-SDU IDs) - 1 </p>
<p>parameter </p>
<p>Parameter type of which the value has to be changes (TP_BS or TP_STMIN). </p>
<p>value </p>
<p>The new value of the parameter. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: request is accepted. </p>
<p>E_NOT_OK: request is not accepted. </p>
<p><b>Functional Description </b></p>
<p>This service is used to request the change of reception parameters BS and STmin for a specified N-SDU. </p>
<p>Modification of parameters is only allowed if currently no reception for the respective N-SDU is in progress. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p><b>&gt; </b></p>
<p>This function is non-reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>This API is optional and can be deactivated </p>
<p>Compiler switch: CANTP_ENABLE_CHANGE_PARAM </p>
<p>Configuration attribute: CanTpChangeParameterApi</p>
<p> </p>
<p>Table 5-11  </p>
<p>CanTp_ChangeParameter() </p>
<p> </p>
<p><b> </b></p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>45 </p>
<p>based on template version 5.7.1 </p>
<p><b>5.1.12 </b></p>
<p><b>CanTp_ReadParameter() </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType</p>
<p> </p>
<p><b>CanTp_ReadParameter</b></p>
<p> </p>
<p>( PduIdType id, TPParameterType parameter, </p>
<p>uint16* value )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>id </p>
<p>Identifier of the Rx N-SDU, for which a flow control parameter shall be read. </p>
<p>Range: 0..(maximum number of Rx N-SDU IDs) - 1 </p>
<p>parameter </p>
<p>Parameter type of which the value has to be read (TP_BS or TP_STMIN). </p>
<p>value </p>
<p>Pointer where the parameter value will be stored. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK: request is accepted. </p>
<p>E_NOT_OK: request is not accepted. </p>
<p><b>Functional Description </b></p>
<p>This service is used to read the current value of reception parameters BS and STmin for a specified N-</p>
<p>SDU. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p><b>&gt; </b></p>
<p>This function is non-reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>This API is optional and can be deactivated </p>
<p>Compiler switch: CANTP_ENABLE_READ_PARAM </p>
<p>Configuration attribute: CanTpReadParameterApi</p>
<p> </p>
<p>Table 5-12  </p>
<p>CanTp_ReadParameter() </p>
<p> </p>
<p><b> </b></p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>46 </p>
<p>based on template version 5.7.1 </p>
<p><b>5.2 </b></p>
<p><b>Services used by CanTp </b></p>
<p>In  the  following  table  services  provided  by  other  components,  which  are  used  by  the </p>
<p>CanTp are listed. For details about prototype and functionality refer to the documentation </p>
<p>of the providing component. </p>
<p><b>Component </b></p>
<p><b>API </b></p>
<p>CanIf </p>
<p>CanIf_Transmit </p>
<p>CanIf_CancelTransmit  </p>
<p>Dcm </p>
<p>Dcm_OnRequestDetection </p>
<p>Det </p>
<p>Det_ReportError </p>
<p>EcuM </p>
<p>EcuM_BswErrorHook </p>
<p>PduR </p>
<p>PduR_CanTpCopyRxData </p>
<p>PduR_CanTpCopyTxData </p>
<p>PduR_CanTpRxIndication </p>
<p>PduR_CanTpStartOfReception </p>
<p>PduR_CanTpTxConfirmation </p>
<p>PduR_CanTpChangeParameterConfirmation </p>
<p>SchM </p>
<p>SchM_Enter_CanTp_* </p>
<p>SchM_Exit_CanTp_*</p>
<p> </p>
<p>Table 5-13  </p>
<p>Services used by the CanTp </p>
<p> </p>
<p><b> </b></p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>47 </p>
<p>based on template version 5.7.1 </p>
<p><b>5.3 </b></p>
<p><b>Callback Functions </b></p>
<p>This chapter describes the callback functions that are implemented by the CanTp and can </p>
<p>be invoked by other modules. The prototypes of the callback functions are provided in the </p>
<p>header file </p>
<p>CanTp_Cbk.h</p>
<p> by the CanTp. </p>
<p><b>5.3.1 </b></p>
<p><b>CanTp_RxIndication() </b></p>
<p><b>Prototype </b></p>
<p>void</p>
<p> </p>
<p><b>CanTp_RxIndication</b></p>
<p> </p>
<p>( PduIdType CanTpRxPduId, const PduInfoType* </p>
<p>CanTpRxPduPtr )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>CanTpRxPduId </p>
<p>Identifier of the Rx N-PDU that have been received. </p>
<p>Range: 0..(maximum number of Rx N-PDU IDs) - 1 </p>
<p>CanTpRxPduPtr </p>
<p>Reference to structure with the size of the received N-PDU (SduLength) and </p>
<p>to the payload data (SduDataPointer) </p>
<p><b>Return code </b></p>
<p>void </p>
<p>N/A </p>
<p><b>Functional Description </b></p>
<p>This function is called by the CAN Interface after a successful reception of an N-PDU. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p><b>&gt; </b></p>
<p>This function is reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous.</p>
<p> </p>
<p>Table 5-14  </p>
<p>CanTp_RxIndication() </p>
<p><b>5.3.2 </b></p>
<p><b>CanTp_TxConfirmation() </b></p>
<p><b>Prototype </b></p>
<p>void</p>
<p> </p>
<p><b>CanTp_TxConfirmation</b></p>
<p> </p>
<p>( PduIdType TxPduId )</p>
<p> </p>
<p><b>Parameter </b></p>
<p>TxPduId </p>
<p>Identifier of the Tx N-PDU that have been transmitted successfully. </p>
<p>Range: 0..(maximum number of Tx N-PDU IDs) - 1 </p>
<p><b>Return code </b></p>
<p>void </p>
<p>N/A </p>
<p><b>Functional Description </b></p>
<p>This function is called by the CAN Interface to confirm the successful transmission of an N-PDU. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>This function can be called from any context. </p>
<p><b>&gt; </b></p>
<p>This function is reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous.</p>
<p> </p>
<p>Table 5-15  </p>
<p>CanTp_TxConfirmation() </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>48 </p>
<p>based on template version 5.7.1 </p>
<p><b>5.3.3 </b></p>
<p><b>CanTp_StopSeparationTime() </b></p>
<p><b>Prototype </b></p>
<p>void <b>CanTp_StopSeparationTime</b>(PduIdType CanTpTxSduId)</p>
<p> </p>
<p><b>Parameter </b></p>
<p>CanTpTxSduId </p>
<p>Symbolic name value of the Tx connection </p>
<p>Note: this is the same ID as it has been passed to the application in the </p>
<p>StartSeparationTime call-out. </p>
<p><b>Return code </b></p>
<p>- </p>
<p>- </p>
<p><b>Functional Description </b></p>
<p>Called by the application to trigger transmission of the next CF when its separation timer expired. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Feature „STmin by Application“ must be active (see 3.1.2.11) </p>
<p><b>&gt; </b></p>
<p>The request to do the separation time handling must have been accepted by the application (see 5.4.1). </p>
<p>If CanTp_StopSeparationTime() is called before Appl_StartSeparationTime returns (e.g. in case of a fast </p>
<p>timer interrupt), the CanTp assumes a positive result and accepts the function call. </p>
<p><b>&gt; </b></p>
<p>In the context of this function, the CanTp will request the CF payload from its upper layer and transmit </p>
<p>the next CF </p>
<p>Table 5-16  </p>
<p>CanTp_StopSeparationTime() </p>
<p><b>5.4 </b></p>
<p><b>Configurable Interfaces </b></p>
<p><b>5.4.1 </b></p>
<p><b>Appl_StartSeparationTime() </b></p>
<p><b>Prototype </b></p>
<p>boolean <b>Appl_StartSeparationTime</b>(PduIdType CanTpTxSduId, uint8 STmin) </p>
<p><b>Parameter </b></p>
<p>CanTpTxSduId </p>
<p>Symbolic name value of the Tx connection. </p>
<p>STmin </p>
<p>STmin value from the flow control (encoding according to ISO). </p>
<p><b>Return code </b></p>
<p>TRUE </p>
<p>request to handle Separation Time is accepted by the application </p>
<p>FALSE </p>
<p>request to handle Separation Time is rejected and will be done by CanTp </p>
<p><b>Functional Description </b></p>
<p>Called by the CanTp to notify the application that a separation timer need to be started. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>The function is called from the TxConfirmation context </p>
<p><b>&gt; </b></p>
<p>The actual name of the function is configured by the parameter </p>
<p>‘CanTp/CanTpGeneral/CanTpApplSTminStartFunction’ </p>
<p>Table 5-17  </p>
<p>Appl_StartSeparationTime() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>49 </p>
<p>based on template version 5.7.1 </p>
<p><b>5.4.2 </b></p>
<p><b>Notification Functions </b></p>
<p>Additional notification callouts can be defined to notify the application about the reception </p>
<p>or  transmission  of  CanTp  frames.  This  may  be  used  for  project  specific  extensions  or </p>
<p>workarounds.  The  function  declarations  are  provided  in </p>
<p>CanTp_Cbk.h</p>
<p>.  To  activate  a </p>
<p>callout, an according compiler switch must be defined to STD_ON in a user config file. </p>
<p><b>5.4.2.1 </b></p>
<p><b>Appl_CanTpRxSFIndication() </b></p>
<p><b>Prototype </b></p>
<p>void <b>Appl_CanTpRxSFIndication </b>(PduIdType          PduRRxPduId,  </p>
<p>                               const PduInfoType* PduInfoPtr); </p>
<p><b>Parameter </b></p>
<p>PduRRxPduId </p>
<p>PduId of the connection, which is defined by the PduR; the same Id is passed </p>
<p>to PduR in PduR_CanTpRxIndication(). </p>
<p>PduInfoPtr </p>
<p>Reference to structure with the size (SduLength) and the CAN frame content </p>
<p>(SduDataPointer) of the single frame. </p>
<p><b>Return code </b></p>
<p>- </p>
<p>- </p>
<p><b>Functional Description </b></p>
<p>Function is called upon successful reception of a single frame N-PDU before the call of </p>
<p>PduR_CanTpStartOfReception(). </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>To activate the callout, CANTP_APPL_RX_SF_INDICATION must be defined to STD_ON </p>
<p>Table 5-18  </p>
<p>Appl_CanTpRxSFIndication() </p>
<p><b>5.4.2.2 </b></p>
<p><b>Appl_CanTpRxFFIndication() </b></p>
<p><b>Prototype </b></p>
<p>void <b>Appl_CanTpRxFFIndication </b>(PduIdType          PduRRxPduId,  </p>
<p>                               const PduInfoType* PduInfoPtr); </p>
<p><b>Parameter </b></p>
<p>PduRRxPduId </p>
<p>PduId of the connection, which is defined by the PduR; the same Id is passed </p>
<p>to PduR in PduR_CanTpRxIndication(). </p>
<p>PduInfoPtr </p>
<p>Reference to structure with the size (SduLength) and the CAN frame content </p>
<p>(SduDataPointer) of the first frame. </p>
<p><b>Return code </b></p>
<p>- </p>
<p>- </p>
<p><b>Functional Description </b></p>
<p>Function is called upon successful reception of a first frame N-PDU before the call of </p>
<p>PduR_CanTpStartOfReception(). </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>To activate the callout, CANTP_APPL_RX_FF_INDICATION must be defined to STD_ON </p>
<p>Table 5-19  </p>
<p>Appl_CanTpRxFFIndication() </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>50 </p>
<p>based on template version 5.7.1 </p>
<p><b>5.4.2.3 </b></p>
<p><b>Appl_CanTpRxCFIndication() </b></p>
<p><b>Prototype </b></p>
<p>void <b>Appl_CanTpRxCFIndication </b>(PduIdType          PduRRxPduId,  </p>
<p>                               const PduInfoType* PduInfoPtr); </p>
<p><b>Parameter </b></p>
<p>PduRRxPduId </p>
<p>PduId of the connection, which is defined by the PduR; the same Id is passed </p>
<p>to PduR in PduR_CanTpRxIndication(). </p>
<p>PduInfoPtr </p>
<p>Reference to structure with the size (SduLength) and the CAN frame content </p>
<p>(SduDataPointer) of the consecutive frame. </p>
<p><b>Return code </b></p>
<p>- </p>
<p>- </p>
<p><b>Functional Description </b></p>
<p>Function is called upon successful reception of a consecutive frame N-PDU before the call of </p>
<p>PduR_CanTpCopyRxData(). </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>To activate the callout, CANTP_APPL_RX_CF_INDICATION must be defined to STD_ON </p>
<p>Table 5-20  </p>
<p>Appl_CanTpRxCFIndication() </p>
<p><b>5.4.2.4 </b></p>
<p><b>Appl_CanTpFrameTransmission () </b></p>
<p><b>Prototype </b></p>
<p>void <b>Appl_CanTFrameTransmission </b>(PduIdType          CanIfTxPduId,  </p>
<p>                                 const PduInfoType* PduInfoPtr); </p>
<p><b>Parameter </b></p>
<p>CanIfTxPduId </p>
<p>PduId of the transmitted CAN message, which is defined by the CanIf; the </p>
<p>same Id is passed to CanIf_Transmit(). </p>
<p>PduInfoPtr </p>
<p>Reference to structure with the size (SduLength) and the content </p>
<p>(SduDataPointer) of the transmitted CAN frame. </p>
<p><b>Return code </b></p>
<p>- </p>
<p>- </p>
<p><b>Functional Description </b></p>
<p>Function is called if transmission of a CanTp N-PDU has successfully been started (CanIf_Transmit() has </p>
<p>been called and returned E_OK). </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>To activate the callout, CANTP_APPL_FRAME_TRANSMISSION must be defined to STD_ON </p>
<p>Table 5-21  </p>
<p>Appl_CanTpFrameTransmission () </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>51 </p>
<p>based on template version 5.7.1 </p>
<p><b>5.4.2.5 </b></p>
<p><b>Appl_CanTpFrameTxConfirmation () </b></p>
<p><b>Prototype </b></p>
<p>void <b>Appl_CanTFrameTxConfirmation </b>(PduIdType CanIfTxPduId); </p>
<p><b>Parameter </b></p>
<p>CanIfTxPduId </p>
<p>PduId of the transmitted CAN message, which is defined by the CanIf; the </p>
<p>same Id is passed to CanIf_Transmit(). </p>
<p><b>Return code </b></p>
<p>- </p>
<p>- </p>
<p><b>Functional Description </b></p>
<p>Function is called if a CanTp N-PDU has successfully been transmitted (at the beginning of </p>
<p>CanTp_TxConfirmation). </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>To activate the callout, CANTP_APPL_FRAME_CONFIRMATION must be defined to STD_ON </p>
<p>Table 5-22  </p>
<p>Appl_CanTpFrameTransmission () </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>52 </p>
<p>based on template version 5.7.1 </p>
<p><b>6 </b></p>
<p><b>Configuration </b></p>
<p>The CanTp attributes can be configured with the following tool: </p>
<p><b>&gt; </b> Configuration in DaVinci Configurator Pro 5 </p>
<p> </p>
<p><b>6.1 </b></p>
<p><b>Configuration Variants </b></p>
<p>The CanTp supports the configuration variant </p>
<p><b>&gt; </b></p>
<p>VARIANT-PRE-COMPILE </p>
<p><b>&gt; </b></p>
<p>VARIANT-POST-BUILD-LOADABLE </p>
<p><b>&gt; </b></p>
<p>VARIANT-POST-BUILD-SELECTABLE </p>
<p>The configuration classes of the CanTp parameters depend on the supported configuration </p>
<p>variants. For their definitions please see the CanTp_bswmd.arxml file. </p>
<p> </p>
<p><b>6.2 </b></p>
<p><b> Configuration of Post-Build </b></p>
<p>The configuration of post-build loadable is described in [7]. </p>
<p>In the CanTp, the following configuration changes are possible at post-build time:  </p>
<p><b>&gt; </b></p>
<p>Modify timing parameters of existing N-SDUs </p>
<p><b>&gt; </b></p>
<p>Activate or disable N-PDU padding of existing N-SDUs (padding must have been </p>
<p>globally enabled at pre-compile time) </p>
<p><b>&gt; </b></p>
<p>Modify flow control parameters of existing Rx N-SDUs (STmin, Block Size, WFTmax) </p>
<p><b>&gt; </b></p>
<p>Change number of channels (dynamic channel assignment must have been enabled </p>
<p>at pre-compile time, see 3.1.2.5) </p>
<p><b>&gt; </b></p>
<p>Add new N-SDUs </p>
<p>Existing references to N-PDUs can’t be changed at post-build time. However, when adding </p>
<p>new N-SDUs, N-PDUs configured at pre-compile time can be referenced. </p>
<p> </p>
<p> </p>
<p><b> </b></p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>53 </p>
<p>based on template version 5.7.1 </p>
<p><b>6.3 </b></p>
<p><b>Additional Configuration Hints </b></p>
<p><b>6.3.1 </b></p>
<p><b>CanIf Tx Buffering </b></p>
<p>The CanTp does not implement a retry mechanism in case the CanIf is not able to transmit </p>
<p>a TP message. If a call to CanIf_Transmit failed, the connection is terminated. </p>
<p>To avoid unpredictable interruption of active CanTp connections, the Tx buffering feature </p>
<p>must be enabled in the CanIf for systems where high bus load and failed transmissions are </p>
<p>expected. </p>
<p> </p>
<p><b>6.3.2 </b></p>
<p><b>ISO Performance Requirements </b></p>
<p>ISO15765-2 defines performance requirements for N_Br and N_Cs (see also 3.9.1), which </p>
<p>frequently leads to confusion. The reason for this is that there is usually no clear distinction </p>
<p>between <b>configured timeouts </b>and the <b>actual timing </b>observed on the bus. </p>
<p>For example, a typical OEM specification may look like that: </p>
<p><b>Timing Parameter </b></p>
<p><b>Value </b></p>
<p>N_As </p>
<p>1000ms </p>
<p>N_Ar </p>
<p>1000ms </p>
<p>N_Bs </p>
<p>1000ms </p>
<p>N_Br </p>
<p>(N_Br + N_Ar) &lt; (0,9*N_Bs) </p>
<p>N_Cs </p>
<p>(N_Cs + N_As) &lt; (0,9*N_Cr) </p>
<p>N_Cr </p>
<p>1000ms </p>
<p>Table 6-1  </p>
<p>Example for typical timing parameter specification </p>
<p>Interpreting all timings as configurable parameters would mean, that only a negative value </p>
<p>can fulfill the specified equation for N_Br and N_Cs. </p>
<p>However, the intent of the requirement is not to specify a concrete value, but to provide a </p>
<p>test criterion for a black box test where e.g. N_Br and N_Ar can’t be measured separately. </p>
<p>So it should be interpreted as follows: </p>
<p> </p>
<p>(actual measured time for N_Br + N_Ar) &lt; (0,9 * configured N_Bs timeout) </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>FAQ: Which values should be used for the config parameters N_Cs and N_Br? </b></p>
<p>The CanTp tries to send out frames as fast as possible. N_Cs and N_Br are mainly </p>
<p>used to abort/complete an operation before it is obvious that the performance time can </p>
<p>no longer be fulfilled (see also 3.9.2.2 for N_Cs and 3.9.2.3 for N_Br).  </p>
<p>So assuming a typical bus delay far below 100ms, for the example above a good </p>
<p>choice for N_Cs and N_Br would be around 800ms. </p>
<p><b> </b></p>
<p><b> </b></p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>54 </p>
<p>based on template version 5.7.1 </p>
<p><b>7 </b></p>
<p><b>Glossary and Abbreviations </b></p>
<p><b>7.1 </b></p>
<p><b>Glossary </b></p>
<p><b>Term </b></p>
<p><b>Description </b></p>
<p>Buffer </p>
<p>A buffer in a memory area normally in the RAM. It is an area that the </p>
<p>application has reserved for data storage. </p>
<p>Callback function </p>
<p>This is a function provided by an application. E.g. the CAN Driver calls a </p>
<p>callback function to allow the application to control some action, to make </p>
<p>decisions at runtime and to influence the work of the driver. </p>
<p>CAN Driver </p>
<p>The CAN Driver encapsulates a specific CAN controller handling. It </p>
<p>consists of algorithms for hardware initialization, CAN message </p>
<p>transmission and reception. The application interface supports both event </p>
<p>and polling notification and WR/RD access to the message buffers. </p>
<p>CAN message </p>
<p>Frame which is composed of the start-of-frame, arbitration, control, data, </p>
<p>CRC, acknowledge and end-of-frame bit fields. </p>
<p>Channel </p>
<p>A channel defines the assignment (1:1) between a physical communication </p>
<p>interface and a physical layer on which different modules are connected to </p>
<p>(either CAN or LIN). 1 channel consists of 1 ... X network(s). </p>
<p>Communication </p>
<p>stack </p>
<p>The communication stack consists of the communication configuration and </p>
<p>the communication kernel, a number of adaptive software components that </p>
<p>cover the basic communication requirements in distributed automotive </p>
<p>applications. </p>
<p>Component </p>
<p>CAN Driver, Network Management ... are software COMPONENTS in </p>
<p>contrast to the expression module, which describes an ECU. </p>
<p>Confirmation </p>
<p>A service primitive defined in the ISO/OSI Reference Model (ISO 7498). </p>
<p>With the service primitive 'confirmation' a service provider informs a service </p>
<p>user about the result of a preceding service request of the service user. </p>
<p>Notification by the CAN Driver on asynchronous successful transmission of </p>
<p>a CAN message. </p>
<p>Critical section </p>
<p>A critical section is a sequence of instructions where mutual exclusion must </p>
<p>be ensured. Such a section is called 'critical' because shared data is </p>
<p>modified within it. </p>
<p>Data consistency </p>
<p>Data consistency means that the content of a given application message </p>
<p>correlates unambiguously to the operation performed onto the message by </p>
<p>the application. This means that no unforeseen sequence of operations </p>
<p>may alter the content of a message hence rendering a message </p>
<p>inconsistent with respect to its allowed and expected value. </p>
<p>Data link layer </p>
<p>The communication layer which provides services for the transfer of data </p>
<p>link messages. The data link layer consists of the communication hardware </p>
<p>and the communication driver software. </p>
<p>DaVinci </p>
<p>Configurator Pro 5 </p>
<p>Configuration and code generation tool for MICROSAR components </p>
<p>Deadlock </p>
<p>A state in which tasks block one another so that further processing of the </p>
<p>tasks concerned is no longer possible. A deadlock between two tasks </p>
<p>occurs, e.g. if both tasks wait for the reception of a message which is to be </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>55 </p>
<p>based on template version 5.7.1 </p>
<p>sent by the other task before sending its own message. </p>
<p>Electronic Control </p>
<p>Unit </p>
<p>Also known as ECU. Small embedded computer system consisting of at </p>
<p>least one CPU and corresponding periphery which is placed in one </p>
<p>housing. </p>
<p>Event </p>
<p>An exclusive signal which is assigned to a certain extended task. An event </p>
<p>can be used to send binary information to an extended task. The meaning </p>
<p>of events is defined by the application. Any task can set an event for an </p>
<p>extended task. The event can only be cleared by the task which is </p>
<p>assigned to the event. </p>
<p>Gateway </p>
<p>A gateway is designed to enable communication between different bus </p>
<p>systems, e.g. from CAN to LIN. </p>
<p>Indication </p>
<p>A service primitive defined in the ISO/OSI Reference Model (ISO 7498). </p>
<p>With the service primitive 'indication' a service provider informs a service </p>
<p>user about the occurrence of either an internal event or a service request </p>
<p>issued by another service user. Notification of application in case of events </p>
<p>in the Vector software components, e.g. an asynchronous reception of a </p>
<p>CAN message. </p>
<p>Interrupt </p>
<p>Processor-specific event which can interrupt the execution of a current </p>
<p>program section. </p>
<p>Interrupt level </p>
<p>Processing level provided for time-critical activities. To keep the interrupt </p>
<p>latency brief, only absolutely indispensable actions should be effected in </p>
<p>the interrupt service routine, which ensures reception of the interrupt and </p>
<p>trigger its (post) processing within a task. Other processing levels are: </p>
<p>Operating system level and task level. </p>
<p>Network </p>
<p>A network defines the assignment (1:N) between a logical communication </p>
<p>grouping and a physical layer on which different modules are connected to </p>
<p>(either CAN or LIN). One network consists of one channel, Y networks </p>
<p>consists of 1 ... Z channel(s). We say network if we talk about more than </p>
<p>one bus. </p>
<p>Physical layer </p>
<p>An electrical circuit that connects an ECU to a communication media. </p>
<p>Platform </p>
<p>The sum of micro controller derivative, communication controller </p>
<p>implementation and compiler is called platform. </p>
<p>Post-build </p>
<p>This type of configuration is possible after building the software module or </p>
<p>the ECU software. The software may either receive parameters of its </p>
<p>configuration during the download of the complete ECU software resulting </p>
<p>from the linkage of the code, or it may receive its configuration file that can </p>
<p>be downloaded to the ECU separately, avoiding a re-compilation and re-</p>
<p>build of the ECU software modules. In order to make the post-build time re-</p>
<p>configuration possible, the re-configurable parameters shall be stored at a </p>
<p>known memory location of ECU storage area. </p>
<p>Segmented data </p>
<p>transfer </p>
<p>See segmented communication </p>
<p>Software </p>
<p>architecture </p>
<p>A software architecture is the structure or structures of a system, which </p>
<p>comprises software components, the external visible properties of these </p>
<p>components and the relationships among them. </p>
<p>Transport Protocol </p>
<p>Some information that must be transferred over the CAN/LIN bus does not </p>
<p>fit into individual message frames because the data length exceeds the </p>
<p>maximum of 8 bytes. In this case, the sender must divide up the data into a </p>
<p>number of messages. Additional information is necessary for the receiver </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>56 </p>
<p>based on template version 5.7.1 </p>
<p>to put the data together again. </p>
<p>Table 7-1  </p>
<p>Glossary </p>
<p><b>7.2 </b></p>
<p><b>Abbreviations </b></p>
<p><b>Abbreviation </b></p>
<p><b>Description </b></p>
<p>AE </p>
<p>Address Extension </p>
<p>API </p>
<p>Application Programming Interface </p>
<p> </p>
<p>AR </p>
<p>AUTOSAR </p>
<p>AUTOSAR </p>
<p>Automotive Open System Architecture </p>
<p>BS </p>
<p>Block Size </p>
<p>BSW </p>
<p>Basis Software </p>
<p>BSWMD </p>
<p>Basic Software Module Description </p>
<p>CAN </p>
<p>Controller Area Network protocol </p>
<p>CAN-FD </p>
<p>CAN with Flexible Data Rate </p>
<p>CANTP </p>
<p>CAN Transport Layer </p>
<p>CF </p>
<p>Consecutive Frame </p>
<p>COM </p>
<p>Communication </p>
<p>CTS </p>
<p>Clear To Send </p>
<p>DCM </p>
<p>Diagnostic Communication Manager </p>
<p>DEM </p>
<p>Diagnostic Event Manager </p>
<p>DET </p>
<p>Development Error Tracer </p>
<p>DL </p>
<p>Data Length </p>
<p>DLC </p>
<p>Data Length Code, Number of data bytes of a CAN message </p>
<p>ECU </p>
<p>Electronic Control Unit </p>
<p>FC </p>
<p>Flow Control </p>
<p>FF </p>
<p>First Frame </p>
<p>FS </p>
<p>Flow Status Control </p>
<p>HIS </p>
<p>Hersteller Initiative Software </p>
<p>ID </p>
<p>Identifier </p>
<p>ISO </p>
<p>International Standardization Organization </p>
<p>LFF </p>
<p>Long First Frame (extended first frame with escape sequence) </p>
<p>LSF </p>
<p>Long Single Frame (extended single frame with escape sequence) </p>
<p>MICROSAR </p>
<p>Microcontroller Open System Architecture (the Vector AUTOSAR </p>
<p>solution) </p>
<p>N </p>
<p>Network Layer (used as prefix; e.g. N-PDU or N-SDU) </p>
<p>OBD </p>
<p>Undefined </p>
<p>OEM </p>
<p>Original Equipment Manufacturer </p>
<p>OS </p>
<p>Operating System </p>
<p>OVFLW </p>
<p>Overflow </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>57 </p>
<p>based on template version 5.7.1 </p>
<p>PB </p>
<p>Post-Build </p>
<p>PDU </p>
<p>Protocol Data Unit </p>
<p>PDUR </p>
<p>PDU Router </p>
<p>ROM </p>
<p>Read-Only Memory </p>
<p>RFC </p>
<p>Request For Comment </p>
<p>RTE </p>
<p>Runtime Environment </p>
<p>SA </p>
<p>Source Address </p>
<p>SDU </p>
<p>Service Data Unit </p>
<p>SF </p>
<p>Single Frame </p>
<p>SN </p>
<p>Sequence Number </p>
<p>SRS </p>
<p>Software Requirement Specification </p>
<p>ST </p>
<p>Separation Time </p>
<p>SWC </p>
<p>Software Component </p>
<p>SWS </p>
<p>Software Specification </p>
<p>TA </p>
<p>Target Address </p>
<p>TP </p>
<p>Transport Protocol </p>
<p>TPCI </p>
<p>Transport Protocol Control Information </p>
<p>WT </p>
<p>Wait </p>
<p>Table 7-2  </p>
<p>Abbreviations </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Transport Layer </p>
<p>© 2017 Vector Informatik GmbH </p>
<p>Version 3.01.00 </p>
<p>58 </p>
<p>based on template version 5.7.1 </p>
<p><b>8 </b></p>
<p><b>Contact </b></p>
<p>Visit our website for more information on </p>
<p> </p>
<p><b>&gt; </b></p>
<p>News </p>
<p><b>&gt; </b></p>
<p>Products </p>
<p><b>&gt; </b></p>
<p>Demo software </p>
<p><b>&gt; </b></p>
<p>Support </p>
<p><b>&gt; </b></p>
<p>Training data </p>
<p><b>&gt; </b></p>
<p>Addresses </p>
<p> </p>
<p>www.vector.com </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
</body>
</html>
{% endraw %}